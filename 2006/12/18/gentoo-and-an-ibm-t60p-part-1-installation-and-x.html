<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link rel=stylesheet href=/blog.css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><title>Gentoo and an IBM T60p - Part 1: Installation and X &ndash; ebullient·works</title><link rel=canonical href=/2006/12/18/gentoo-and-an-ibm-t60p-part-1-installation-and-x.html></head><body><div class=wrapper><header class=page-header><h1><a href=/>ebullient·works</a></h1><div>[ <a href=/about/>About</a> &#183; <a href=/archive/>Archive</a> ]</div></header><article class=post><header><h1>Gentoo and an IBM T60p - Part 1: Installation and X</h1></header><section class=content><p>Got a new T60 <strong>yay!</strong>, here's my brain dump on getting it to work with gentoo (2006.1).</p><p>See also (Updated as new parts are added):</p><ul><li><a href=/config/261/GentooandanIBMT60pPart2>Part 2: <span class=caps>NTFS</span></a></li><li><a href=/config/260/GentooandanIBMT60pPart3>Part 3: Networking</a></li></ul><h3>General 'fo:</h3><table><tr><td>Motherboard:</td><td>Lenovo ThinkPad T60 2613EJU<sup id=fnrev21131636054fd685f89dc07 class=footnote><a href=#fn21131636054fd685f89dc07>1</a></sup></td></tr><tr><td>Processor:</td><td>Intel Core Duo T2600 (2.16GHz)<sup id=fnrev15003744444fd685f89de7a class=footnote><a href=#fn15003744444fd685f89de7a>2</a></sup></td></tr><tr><td>Memory:</td><td>2 &#215; 1G DDR2</td></tr><tr><td>Graphics Card:</td><td><span class=caps>ATI</span> Mobility FireGL 256MB</td></tr><tr><td>Hard Drives:</td><td>100GB <span class=caps>SATA</span> 7200RPM</td></tr><tr><td>Sound Card:</td><td>Intel (ICH7) : <span class=caps>ALSA</span> hda-intel<sup id=fnrev16564309884fd685f89e634 class=footnote><a href=#fn16564309884fd685f89e634>3</a></sup></td></tr><tr><td>Wired:</td><td>Intel Corp. 82573L Gigabit</td></tr><tr><td>Wireless:</td><td>Atheros Communications AR5212 <span class=caps>NIC</span></td></tr></table><h3>Installation</h3><p>I followed the general install instructions for gentoo; no rocket science here. I used 2006.1/desktop profile, which sets a lot of handy use flags for you – what you have to do is unset those you don't want (like gnome or kde). In general, I try to keep the global flags list short(er) – though the default desktop profile pulls a lot of stuff in. I prefer setting use flags per package via the /etc/portage/package.use file.</p><blockquote><p>added: acpi directfb dmx fbcon fuse gtk2 hdaps madwifi mmx motif opengl real samba smp sse sse2 svg syslog usb wifi</p></blockquote><blockquote><p>removed: -arts -apm -esd -gnome -ipv6 -kde -ldap -nls</p></blockquote><p><em>Note:</em> <code>euse</code> (from gentoolkit) is very useful here. Using <code>euse -i</code> you can tell: a) all of the packages that make use of a given flag and what they use it for, and b) whether or not it's included or excluded from the default profile or from your make.conf. Handy stuff.</p><p>I adjusted the grub install for Dual-boot, and did some checking for kernel options: a) <span class=caps>ACPI</span> configuration, b) removing <span class=caps>DRM</span> because of the <span class=caps>ATI</span> chipset (below), etc.</p><p>Just for the hell of it, I set up sSMTP to route to my gmail account<sup id=fnrev4313280124fd685f89fc9d class=footnote><a href=#fn4313280124fd685f89fc9d>4</a></sup>.</p><ul><li>sys-kernel/gentoo-sources-2.6.18-r3</li><li><a href=/files/config-2.6.18-gentoo-r3.txt>kernel .config</a></li></ul><h3>Pointing devices:</h3><p>I decided to add drivers for the touchpad (we'll see how long it lasts – I'll probably end up disabling it via the <span class=caps>BIOS</span>..) and for using the mouse on(in? at?) the console. I didn't need to do anything special aside from emerging the packages (and in the case of gpm, starting the daemon via /etc/init.d/gpm).</p><ul><li>x11-drivers/synaptics-0.14.5-r1</li><li>sys-libs/gpm-1.20.1-r5</li></ul><h3>On-Screen Display and Thinkpad things</h3><p>For thinkpad buttons, I use <code>tpb</code> with the <code>xosd</code> use flag to enable on-screen display when you push things (like the volume buttons). After emerging tpb, update <code>/etc/tpbrc</code> per your preferences. Use the <code>hdaps</code> useflag with <code>tm_smapi</code> to enable 1/2 of automatic HD head parking function (the reading-the-data part).</p><p>For on-screen display to work w/ X, you have to start tpb when you start X, and it has to have access to the display, etc.</p><ul><li>x11-libs/xosd-2.2.14-r1</li><li>app-laptop/tpb-0.6.4</li><li>app-laptop/tp_smapi-0.27</li><li>app-laptop/tpctl-4.17</li><li><a href=/files/tpb.sh>script for starting tpb</a></li></ul><h3>Setting up X</h3><p>This is the fun part. As noted above, the T60 uses an <span class=caps>ATI</span> FireGL graphics chipset, which means binary <span class=caps>ATI</span> drivers<sup id=fnrev19985520194fd685f8a126c class=footnote><a href=#fn19985520194fd685f8a126c>5</a></sup>. I grabbed the latest of both <code>ati-drivers</code> and <code>ati-drivers-extra</code> (with <code>~x86</code> for both in /etc/portage/package.keywords). The combination of use flags mentioned above were sufficient for both packages.</p><p><em>Note:</em> <code>ati-drivers-extra-8.30.3</code> required libXinerama when the qt use flag is enabled, even if qt did not use that flag. I had to emerge <code>x11-libs/libXinerama</code> for <code>ati-drivers-extra</code> to compile properly.</p><p>After emerging the package (followed by <code>source /etc/profile</code> to regen path strings), I copied the <code>xorg.conf.example</code> to <code>xorg.conf</code> (in <code>/etc/X11</code>) and used <code>aticonfig --initial --input=/etc/X11/xorg.conf</code> to create an initial xorg.conf file. Then I updated the file to strip down what was in there – keeping the <span class=caps>ATI</span> stuff, and punting the extra stuff.</p><p>Without too much fooling around, X came up (with <span class=caps>DRI</span> and everything). The settings generated by aticonfig left a lot to X11 defaults. 1600&#215;1200 at depth 24:<br><pre><code># xdpyinfo | grep resolution -A 1 -B 1
dimensions: 1600x1200 pixels (301x221 millimeters)
resolution: 135x138 dots per inch
depths (7): 24, 1, 4, 8, 15, 16, 32
</code></pre></p><p>Now, I did check out <code>sys-apps/ddcxinfo-knoppix</code>, and I have to say it's pretty neat. It spat out all kinds of things about the <span class=caps>TFT</span> display. I've included the output in the list below.</p><ul><li>x11-drivers/ati-drivers-8.30.3-r1</li><li>x11-apps/ati-drivers-extra-8.30.3</li><li>x11-base/xorg-x11-7.1</li><li><a href=/files/xorg.conf.t60p>xorg.conf</a></li><li><a href=/files/T60p.ddcxinfo>ddcxinfo-knoppix for T60p <span class=caps>TFT</span> display</a>, <a href=/files/T60p.ddcxinfo.monitor>ddcxinfo-knoppix monitor section</a></li></ul><p>I did see the following message in Xorg.0.log: <code>(EE) AIGLX error: dlopen of /usr/lib/dri/fglrx_dri.so failed (/usr/lib/dri/fglrx_dri.so: cannot open shared object file: No such file or directory)</code>. According to the <a href=http://www.gentoo.org/proj/en/desktop/x/x11/modular-x-howto.xml>Modular X Migration</a> guide:</p><blockquote><p>Note: With modular installed, external drivers such as nvidia-glx and wacom as well as some vnc apps may not work if they install things to <code>/usr/lib/modules</code> instead of <code>/usr/lib/xorg/modules</code>. Many of these will have modular X detection added to the installation process.</p></blockquote><p>The ati-drivers ebuild does have such detection, and the requested library was installed in the new location (<code>/usr/lib/xorg/modules/dri</code>) however, it looks like the code trying to load the <span class=caps>DLL</span> is still expecting it in the old place? I tried the most obvious first.. create a symlink from the new location to the old. That seemed to really open things up.</p><pre><code># glxinfo
direct rendering: Yes
server glx vendor string: SGI
server glx version string: 1.2
...
client glx vendor string: ATI
client glx version string: 1.3
...
OpenGL vendor string: ATI Technologies Inc.
OpenGL renderer string: ATI MOBILITY FireGL V5200 Pentium 4 (SSE2) (FireGL) (GNU_ICD)
OpenGL version string: 2.0.6119 (8.30.3)
</code></pre><p>I still, however, saw an error message: <code>AIGLX error: dlsym for __driCreateNewScreen_20050727 failed (/usr/lib/dri/fglrx_dri.so: undefined symbol: __driCreateNewScreen_20050727</code>. This seems not to harm anything, and the screen is so darn beautiful I just want to use it for awhile.</p><h3>Sound</h3><p>Why not. Sound next. In the kernal config, I enabled support for <span class=caps>ALSA</span> as modules. I enabled Intel HD Audio PCI Driver for the kernel-based hda-intel module. I didn't have to set up any of the dmix stuff I used to, as (I seem to remember reading) that's all built in these days. Everything "appears to function" right out of the box. Goodness!</p><ul><li>media-sound/alsa-utils-1.0.13</li><li>media-libs/alsa-oss-1.0.12</li></ul><h3>Footnotes / References :</h3><p id=fn21131636054fd685f89dc07 class=footnote><sup>1</sup> <a href="http://www-307.ibm.com/pc/support/site.wss/document.do?sitestyle=lenovo&lndocid=MIGR-62487">Overview – ThinkPad T60, T60p</a> <span class=attribute>[<a href=http://www.ibm.com>www.ibm.com</a>]</span></p><p id=fn15003744444fd685f89de7a class=footnote><sup>2</sup> <a href=http://support.intel.com/support/notebook/centrino/duo/>Intel&#174; Centrino&#8482; Duo Mobile Technology</a> <span class=attribute>[<a href=http://www.intel.com>intel.com</a>]</span><br><a href="http://processorfinder.intel.com/details.aspx?sSpec=SL8VN">Intel&#174; Core&#8482; Duo processor T2600</a></p><p id=fn16564309884fd685f89e634 class=footnote><sup>3</sup> <a href="http://www.alsa-project.org/alsa-doc/doc-php/template.php?company=Intel&card=ICH+southbridge+HD-audio+and+modem.&chip=ICH6%2C+ICH6M%2C+ICH7%2C+ESB2&module=hda-intel"><span class=caps>ALSA</span>: hda-intel</a> <span class=attribute>[<a href=http://www.alsa-project.org>alsa-project.org</a>]</span></p><p id=fn4313280124fd685f89fc9d class=footnote><sup>4</sup> <a href=http://gentoo-wiki.com/HOWTO_Gmail_and_sSMTP><span class=caps>HOWTO</span> Gmail and sSMTP</a> <span class=attribute>[<a href=http://gentoo-wiki.com/>gentoo-wiki.com</a>]</span></p><p id=fn19985520194fd685f8a126c class=footnote><sup>5</sup> <a href=http://odin.prohosting.com/wedge01/gentoo-radeon-faq.html#1_whyuse>Gentoo <span class=caps>ATI</span> Radeon <span class=caps>FAQ</span></a> <span class=attribute>[<a href=http://odin.prohosting.com/wedge01/>odin.prohosting.com/wedge01</a>]</span></p><p id=fn6 class=footnote><sup>6</sup> <a href=http://www.mozilla.org/unix/dpi.html>Mozilla Font Size / <span class=caps>DPI</span> Issues</a></p><h3>Other References (of course):</h3><ul><li><a href=http://tuxmobil.org/centrino.html>Linux on Intel&#174; Centrino&#8482; and Centrino-Duo&#8482; Laptops and Notebooks</a> <span class=attribute>[<a href=http://tuxmobil.org/>tuxmobil.org</a>]</span></li><li><a href=http://tuxmobil.org/ibm.html>Linux Laptop and Notebook Installation Survey: <span class=caps>IBM</span>/Lenovo</a> <span class=attribute>[<a href=http://tuxmobil.org/>tuxmobil.org</a>]</span></li></ul><ul><li><a href=http://www.hardwareinreview.com/cms/content/view/49>Lenovo ThinkPad T60p review</a> <span class=attribute>[<a href=http://www.hardwareinreview.com>hardwareinreview.com</a>]</span></li><li><a href=http://thinkwiki.org/wiki/Category:T60p>Category:T60p</a> <span class=attribute>[<a href=http://thinkwiki.org/>thinkwiki.org</a>]</span></li><li><a href="http://zachtib.com/?p=19">The new Thinkpad T60p</a> <span class=attribute>[<a href=http://zachtib.com>zachtib.com</a>]</span></li><li><a href=http://buzzy.tesuji.org/thinkpad_t60p.html>Gentoo Linux on the Thinkpad T60p</a></li><li><a href=http://www.thinkwiki.org/wiki/Installation_instructions_for_the_ThinkPad_T60p>Installation instructions for the ThinkPad T60p</a> <span class=attribute>[<a href=http://www.thinkwiki.org>thinkwiki.org</a>]</span></li><li><a href=http://www.thinkwiki.org/wiki/HDAPS><span class=caps>HDAPS</span></a> <span class=attribute>[<a href=http://www.thinkwiki.org>thinkwiki.org</a>]</span><ul><li><a href=http://www.thinkwiki.org/wiki/How_to_protect_the_harddisk_through_APS>How to protect the harddisk through <span class=caps>APS</span></a></li></ul></li><li><a href=http://gentoo-wiki.com/HOWTO_ALSA_sound_mixer_aka_dmix title="Complete, include sound mixer"><span class=caps>HOWTO</span> Alsa</a> <span class=attribute>[<a href=http://gentoo-wiki.com>gentoo-wiki.com</a>]</span></li><li><a href=http://www.infinitephoto.com/pages/dpi.htm><span class=caps>DPI</span> and File Size calculator/formulas</a> <span class=attribute>[<a href=http://www.infinitephoto.com>www.infinitephoto.com</a>]</span></li></ul><p><em>2007-01-05: Updated to make all linked files work (missed uploading a few), added link to Parts 2 and 3.</em></p></section><footer class=byline><div>posted <time class=post_date>18 December 2006</time></div><div class=tags>tags:<ul><li>&nbsp;<a href=/tags/#gentoo>gentoo</a></li><li>&nbsp;<a href=/tags/#thinkpad>thinkpad</a></li></ul></div></footer></article><nav class=prev-next><div class=nav-left><a href=/2006/07/11/rails-printing-validation-errors-as-flash-notices.html title="Previous: Rails: Printing validation errors as flash notices">&#171; Older</a></div><div class=nav-center><a href=/>Top</a> | <a href=/archive/>Archive</a></div><div class=nav-right><a href=/2006/12/29/rails-staying-away-from-enums-in-migrations.html title="Next: Rails: Staying away from Enums in Migrations">Newer &#187;</a></div></nav></div><footer class=page-footer><div id=copyrights>&#169; 2002-2021 Erin Schnabel</div><div><a target=_blank href=https://github.com/ebullient title="ebullient on GitHub"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1664 896q0 251-146.5 451.5T1139 1625q-27 5-39.5-7t-12.5-30v-211q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105T1386 856q0-121-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27T578 459.5 492 446q-44 113-7 204-79 85-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-40 36-49 103-21 10-45 15t-57 5-65.5-21.5T484 1274q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 89t.5 54q0 18-13 30t-40 7q-232-77-378.5-277.5T128 896q0-209 103-385.5T510.5 231 896 128t385.5 103T1561 510.5 1664 896z" fill="#fff"/></svg></a><a target=_blank href=https://twitter.com/ebullientworks title="Follow @ebullientworks"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5T1369.5 1125 1185 1335.5t-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5T285 1033q33 5 61 5 43 0 85-11-112-23-185.5-111.5T172 710v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5T884 653q-8-38-8-74 0-134 94.5-228.5T1199 256q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z" fill="#fff"/></svg></a><a target=_blank href=https://www.linkedin.com/in/erinschnabel/ title="Erin Schnabel on linked.in"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991H147V625h330zm21-306q1 73-50.5 122T312 490h-2q-82 0-132-49t-50-122q0-74 51.5-122.5T314 148t133 48.5T498 319zm1166 729v568h-329v-530q0-105-40.5-164.5T1168 862q-63 0-105.5 34.5T999 982q-11 30-11 81v553H659q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5T1285 602q171 0 275 113.5t104 332.5z" fill="#fff"/></svg></a><a target=_blank href=https://gameontext.org/slackin/ title="ebullient on gameontext.slack.com"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1583 776q62 0 103.5 40.5T1728 918q0 97-93 130l-172 59 56 167q7 21 7 47 0 59-42 102t-101 43q-47 0-85.5-27t-53.5-72l-55-165-310 106 55 164q8 24 8 47 0 59-42 102t-102 43q-47 0-85-27t-53-72l-55-163-153 53q-29 9-50 9-61 0-101.5-40T260 1323q0-47 27.5-85t71.5-53l156-53-105-313-156 54q-26 8-48 8-60 0-101-40.5T64 740q0-47 27.5-85t71.5-53l157-53-53-159q-8-24-8-47 0-60 42-102.5T403 198q47 0 85 27t53 72l54 160 310-105-54-160q-8-24-8-47 0-59 42.5-102T987 0q47 0 85.5 27.5T1126 99l53 161 162-55q21-6 43-6 60 0 102.5 39.5T1529 337q0 45-30 81.5t-74 51.5l-157 54 105 316 164-56q24-8 46-8zm-794 262 310-105-105-315-310 107z" fill="#fff"/></svg></a><a target=_blank href=https://pinboard.in/u:ebullient title=pinboard.in><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 25 25" enable-background="new 0 0 25 25"><polygon fill="#fff" points="13.908,14.85 9.211,19.547 9.961,15.412 3.571,7.706 0,7.894 7.895,0 7.895,3.007 15.412,9.773 20.111,8.647 15.227,13.721 25,24.436"/></svg></a><a target=_blank href=/index.xml title=Subscribe><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M576 1344q0 80-56 136t-136 56-136-56-56-136 56-136 136-56 136 56 56 136zm512 123q2 28-17 48-18 21-47 21H889q-25 0-43-16.5t-20-41.5q-22-229-184.5-391.5T250 902q-25-2-41.5-20T192 839V704q0-29 21-47 17-17 43-17h5q160 13 306 80.5T826 902q114 113 181.5 259t80.5 306zm512 2q2 27-18 47-18 20-46 20h-143q-26 0-44.5-17.5T1329 1476q-12-215-101-408.5t-231.5-336-336-231.5T252 398q-25-1-42.5-19.5T192 335V192q0-28 20-46 18-18 44-18h3q262 13 501.5 120T1186 542q187 186 294 425.5t120 501.5z" fill="#fff"/></svg></a></div></footer><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1146860-5','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>