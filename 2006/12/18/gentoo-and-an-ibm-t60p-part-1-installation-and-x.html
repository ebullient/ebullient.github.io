<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="chrome=1">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<link rel=stylesheet href=/blog.css>
<link rel="shortcut icon" href=/favicon.ico type=image/x-icon>
<title>
Gentoo and an IBM T60p - Part 1: Installation and X &ndash; ebullient·works
</title>
<link rel=canonical href=/2006/12/18/gentoo-and-an-ibm-t60p-part-1-installation-and-x.html>
</head>
<body>
<div class=wrapper>
<header class=page-header>
<h1><a href=/>ebullient·works</a></h1>
<div>
[ <a href=/about/>About</a> &#183; <a href=/archive/>Archive</a> &#183; <a href=/tags/>Tags</a> ]
</div>
</header>
<main class=page id=content>
<article class=post>
<header>
<h1>Gentoo and an IBM T60p - Part 1: Installation and X</h1>
</header>
<section class=content>
<p>Got a new T60 <strong>yay!</strong>, here's my brain dump on getting it to work with gentoo (2006.1).</p>
<p>See also (Updated as new parts are added):</p>
<ul>
<li><a href=/config/261/GentooandanIBMT60pPart2>Part 2: <span class=caps>NTFS</span></a></li>
<li><a href=/config/260/GentooandanIBMT60pPart3>Part 3: Networking</a></li>
</ul>
<h3>General 'fo:</h3>
<table>
<tr>
<td>Motherboard: </td>
<td>Lenovo ThinkPad T60 2613EJU<sup id=fnrev21131636054fd685f89dc07 class=footnote><a href=#fn21131636054fd685f89dc07>1</a></sup></td>
</tr>
<tr>
<td>Processor: </td>
<td>Intel Core Duo T2600 (2.16GHz)<sup id=fnrev15003744444fd685f89de7a class=footnote><a href=#fn15003744444fd685f89de7a>2</a></sup></td>
</tr>
<tr>
<td>Memory: </td>
<td>2 &#215; 1G DDR2</td>
</tr>
<tr>
<td>Graphics Card: </td>
<td><span class=caps>ATI</span> Mobility FireGL 256MB</td>
</tr>
<tr>
<td>Hard Drives: </td>
<td>100GB <span class=caps>SATA</span> 7200RPM</td>
</tr>
<tr>
<td>Sound Card: </td>
<td>Intel (ICH7) : <span class=caps>ALSA</span> hda-intel<sup id=fnrev16564309884fd685f89e634 class=footnote><a href=#fn16564309884fd685f89e634>3</a></sup></td>
</tr>
<tr>
<td>Wired: </td>
<td>Intel Corp. 82573L Gigabit</td>
</tr>
<tr>
<td>Wireless: </td>
<td>Atheros Communications AR5212 <span class=caps>NIC</span></td>
</tr>
</table>
<h3>Installation</h3>
<p>I followed the general install instructions for gentoo; no rocket science here. I used 2006.1/desktop profile, which sets a lot of handy use flags for you – what you have to do is unset those you don't want (like gnome or kde). In general, I try to keep the global flags list short(er) – though the default desktop profile pulls a lot of stuff in. I prefer setting use flags per package via the /etc/portage/package.use file.</p>
<blockquote>
<p>added: acpi directfb dmx fbcon fuse gtk2 hdaps madwifi mmx motif opengl real samba smp sse sse2 svg syslog usb wifi</p>
</blockquote>
<blockquote>
<p>removed: -arts -apm -esd -gnome -ipv6 -kde -ldap -nls</p>
</blockquote>
<p><em>Note:</em> <code>euse</code> (from gentoolkit) is very useful here. Using <code>euse -i</code> you can tell: a) all of the packages that make use of a given flag and what they use it for, and b) whether or not it's included or excluded from the default profile or from your make.conf. Handy stuff. </p>
<p>I adjusted the grub install for Dual-boot, and did some checking for kernel options: a) <span class=caps>ACPI</span> configuration, b) removing <span class=caps>DRM</span> because of the <span class=caps>ATI</span> chipset (below), etc.</p>
<p>Just for the hell of it, I set up sSMTP to route to my gmail account<sup id=fnrev4313280124fd685f89fc9d class=footnote><a href=#fn4313280124fd685f89fc9d>4</a></sup>.</p>
<ul>
<li>sys-kernel/gentoo-sources-2.6.18-r3</li>
<li><a href=/files/config-2.6.18-gentoo-r3.txt>kernel .config</a></li>
</ul>
<h3>Pointing devices: </h3>
<p>I decided to add drivers for the touchpad (we'll see how long it lasts – I'll probably end up disabling it via the <span class=caps>BIOS</span>..) and for using the mouse on(in? at?) the console. I didn't need to do anything special aside from emerging the packages (and in the case of gpm, starting the daemon via /etc/init.d/gpm).</p>
<ul>
<li>x11-drivers/synaptics-0.14.5-r1</li>
<li>sys-libs/gpm-1.20.1-r5</li>
</ul>
<h3>On-Screen Display and Thinkpad things</h3>
<p>For thinkpad buttons, I use <code>tpb</code> with the <code>xosd</code> use flag to enable on-screen display when you push things (like the volume buttons). After emerging tpb, update <code>/etc/tpbrc</code> per your preferences. Use the <code>hdaps</code> useflag with <code>tm_smapi</code> to enable 1/2 of automatic HD head parking function (the reading-the-data part).</p>
<p>For on-screen display to work w/ X, you have to start tpb when you start X, and it has to have access to the display, etc.</p>
<ul>
<li>x11-libs/xosd-2.2.14-r1</li>
<li>app-laptop/tpb-0.6.4</li>
<li>app-laptop/tp_smapi-0.27</li>
<li>app-laptop/tpctl-4.17</li>
<li><a href=/files/tpb.sh>script for starting tpb</a></li>
</ul>
<h3>Setting up X</h3>
<p>This is the fun part. As noted above, the T60 uses an <span class=caps>ATI</span> FireGL graphics chipset, which means binary <span class=caps>ATI</span> drivers<sup id=fnrev19985520194fd685f8a126c class=footnote><a href=#fn19985520194fd685f8a126c>5</a></sup>. I grabbed the latest of both <code>ati-drivers</code> and <code>ati-drivers-extra</code> (with <code>~x86</code> for both in /etc/portage/package.keywords). The combination of use flags mentioned above were sufficient for both packages.</p>
<p><em>Note:</em> <code>ati-drivers-extra-8.30.3</code> required libXinerama when the qt use flag is enabled, even if qt did not use that flag. I had to emerge <code>x11-libs/libXinerama</code> for <code>ati-drivers-extra</code> to compile properly.</p>
<p>After emerging the package (followed by <code>source /etc/profile</code> to regen path strings), I copied the <code>xorg.conf.example</code> to <code>xorg.conf</code> (in <code>/etc/X11</code>) and used <code>aticonfig --initial --input=/etc/X11/xorg.conf</code> to create an initial xorg.conf file. Then I updated the file to strip down what was in there – keeping the <span class=caps>ATI</span> stuff, and punting the extra stuff.</p>
<p>Without too much fooling around, X came up (with <span class=caps>DRI</span> and everything). The settings generated by aticonfig left a lot to X11 defaults. 1600&#215;1200 at depth 24:<br>
<pre><code># xdpyinfo | grep resolution -A 1 -B 1
dimensions: 1600x1200 pixels (301x221 millimeters)
resolution: 135x138 dots per inch
depths (7): 24, 1, 4, 8, 15, 16, 32
</code></pre></p>
<p>Now, I did check out <code>sys-apps/ddcxinfo-knoppix</code>, and I have to say it's pretty neat. It spat out all kinds of things about the <span class=caps>TFT</span> display. I've included the output in the list below.</p>
<ul>
<li>x11-drivers/ati-drivers-8.30.3-r1</li>
<li>x11-apps/ati-drivers-extra-8.30.3</li>
<li>x11-base/xorg-x11-7.1</li>
<li><a href=/files/xorg.conf.t60p>xorg.conf</a></li>
<li><a href=/files/T60p.ddcxinfo>ddcxinfo-knoppix for T60p <span class=caps>TFT</span> display</a>, <a href=/files/T60p.ddcxinfo.monitor>ddcxinfo-knoppix monitor section</a></li>
</ul>
<p>I did see the following message in Xorg.0.log: <code>(EE) AIGLX error: dlopen of /usr/lib/dri/fglrx_dri.so failed (/usr/lib/dri/fglrx_dri.so: cannot open shared object file: No such file or directory)</code>. According to the <a href=http://www.gentoo.org/proj/en/desktop/x/x11/modular-x-howto.xml>Modular X Migration</a> guide:</p>
<blockquote>
<p>Note: With modular installed, external drivers such as nvidia-glx and wacom as well as some vnc apps may not work if they install things to <code>/usr/lib/modules</code> instead of <code>/usr/lib/xorg/modules</code>. Many of these will have modular X detection added to the installation process.</p>
</blockquote>
<p>The ati-drivers ebuild does have such detection, and the requested library was installed in the new location (<code>/usr/lib/xorg/modules/dri</code>) however, it looks like the code trying to load the <span class=caps>DLL</span> is still expecting it in the old place? I tried the most obvious first.. create a symlink from the new location to the old. That seemed to really open things up.</p>
<pre><code># glxinfo
direct rendering: Yes
server glx vendor string: SGI
server glx version string: 1.2
...
client glx vendor string: ATI
client glx version string: 1.3
...
OpenGL vendor string: ATI Technologies Inc.
OpenGL renderer string: ATI MOBILITY FireGL V5200 Pentium 4 (SSE2) (FireGL) (GNU_ICD)
OpenGL version string: 2.0.6119 (8.30.3)
</code></pre>
<p>I still, however, saw an error message: <code>AIGLX error: dlsym for __driCreateNewScreen_20050727 failed (/usr/lib/dri/fglrx_dri.so: undefined symbol: __driCreateNewScreen_20050727</code>. This seems not to harm anything, and the screen is so darn beautiful I just want to use it for awhile.</p>
<h3>Sound</h3>
<p>Why not. Sound next. In the kernal config, I enabled support for <span class=caps>ALSA</span> as modules. I enabled Intel HD Audio PCI Driver for the kernel-based hda-intel module. I didn't have to set up any of the dmix stuff I used to, as (I seem to remember reading) that's all built in these days. Everything "appears to function" right out of the box. Goodness!</p>
<ul>
<li>media-sound/alsa-utils-1.0.13</li>
<li>media-libs/alsa-oss-1.0.12</li>
</ul>
<h3>Footnotes / References :</h3>
<p id=fn21131636054fd685f89dc07 class=footnote><sup>1</sup> <a href="http://www-307.ibm.com/pc/support/site.wss/document.do?sitestyle=lenovo&lndocid=MIGR-62487">Overview – ThinkPad T60, T60p</a> <span class=attribute>[<a href=http://www.ibm.com>www.ibm.com</a>]</span></p>
<p id=fn15003744444fd685f89de7a class=footnote><sup>2</sup> <a href=http://support.intel.com/support/notebook/centrino/duo/>Intel&#174; Centrino&#8482; Duo Mobile Technology</a> <span class=attribute>[<a href=http://www.intel.com>intel.com</a>]</span><br>
<a href="http://processorfinder.intel.com/details.aspx?sSpec=SL8VN">Intel&#174; Core&#8482; Duo processor T2600</a></p>
<p id=fn16564309884fd685f89e634 class=footnote><sup>3</sup> <a href="http://www.alsa-project.org/alsa-doc/doc-php/template.php?company=Intel&card=ICH+southbridge+HD-audio+and+modem.&chip=ICH6%2C+ICH6M%2C+ICH7%2C+ESB2&module=hda-intel"><span class=caps>ALSA</span>: hda-intel</a> <span class=attribute>[<a href=http://www.alsa-project.org>alsa-project.org</a>]</span></p>
<p id=fn4313280124fd685f89fc9d class=footnote><sup>4</sup> <a href=http://gentoo-wiki.com/HOWTO_Gmail_and_sSMTP><span class=caps>HOWTO</span> Gmail and sSMTP</a> <span class=attribute>[<a href=http://gentoo-wiki.com/>gentoo-wiki.com</a>]</span></p>
<p id=fn19985520194fd685f8a126c class=footnote><sup>5</sup> <a href=http://odin.prohosting.com/wedge01/gentoo-radeon-faq.html#1_whyuse>Gentoo <span class=caps>ATI</span> Radeon <span class=caps>FAQ</span></a> <span class=attribute>[<a href=http://odin.prohosting.com/wedge01/>odin.prohosting.com/wedge01</a>]</span></p>
<p id=fn6 class=footnote><sup>6</sup> <a href=http://www.mozilla.org/unix/dpi.html>Mozilla Font Size / <span class=caps>DPI</span> Issues</a></p>
<h3>Other References (of course):</h3>
<ul>
<li><a href=http://tuxmobil.org/centrino.html>Linux on Intel&#174; Centrino&#8482; and Centrino-Duo&#8482; Laptops and Notebooks</a> <span class=attribute>[<a href=http://tuxmobil.org/>tuxmobil.org</a>]</span></li>
<li><a href=http://tuxmobil.org/ibm.html>Linux Laptop and Notebook Installation Survey: <span class=caps>IBM</span>/Lenovo</a> <span class=attribute>[<a href=http://tuxmobil.org/>tuxmobil.org</a>]</span></li>
</ul>
<ul>
<li><a href=http://www.hardwareinreview.com/cms/content/view/49>Lenovo ThinkPad T60p review</a> <span class=attribute>[<a href=http://www.hardwareinreview.com>hardwareinreview.com</a>]</span></li>
<li><a href=http://thinkwiki.org/wiki/Category:T60p>Category:T60p</a> <span class=attribute>[<a href=http://thinkwiki.org/>thinkwiki.org</a>]</span></li>
<li><a href="http://zachtib.com/?p=19">The new Thinkpad T60p</a> <span class=attribute>[<a href=http://zachtib.com>zachtib.com</a>]</span></li>
<li><a href=http://buzzy.tesuji.org/thinkpad_t60p.html>Gentoo Linux on the Thinkpad T60p</a></li>
<li><a href=http://www.thinkwiki.org/wiki/Installation_instructions_for_the_ThinkPad_T60p>Installation instructions for the ThinkPad T60p</a> <span class=attribute>[<a href=http://www.thinkwiki.org>thinkwiki.org</a>]</span></li>
<li><a href=http://www.thinkwiki.org/wiki/HDAPS><span class=caps>HDAPS</span></a> <span class=attribute>[<a href=http://www.thinkwiki.org>thinkwiki.org</a>]</span>
<ul>
<li><a href=http://www.thinkwiki.org/wiki/How_to_protect_the_harddisk_through_APS>How to protect the harddisk through <span class=caps>APS</span></a></li>
</ul></li>
<li><a href=http://gentoo-wiki.com/HOWTO_ALSA_sound_mixer_aka_dmix title="Complete, include sound mixer"><span class=caps>HOWTO</span> Alsa</a> <span class=attribute>[<a href=http://gentoo-wiki.com>gentoo-wiki.com</a>]</span></li>
<li><a href=http://www.infinitephoto.com/pages/dpi.htm><span class=caps>DPI</span> and File Size calculator/formulas</a> <span class=attribute>[<a href=http://www.infinitephoto.com>www.infinitephoto.com</a>]</span></li>
</ul>
<p><em>2007-01-05: Updated to make all linked files work (missed uploading a few), added link to Parts 2 and 3.</em></p>
</section>
<footer class=byline>
<div>posted <time class=post_date>18 December 2006</time></div>
<div class=tags>tags:
<ul><li>&nbsp;<a href=/tags/#linux-gentoo>linux-gentoo</a></li><li>&nbsp;<a href=/tags/#hardware-thinkpad>hardware-thinkpad</a></li></ul>
</div>
</footer>
</article>
<nav class=prev-next>
<div class=nav-left><a href=/2006/07/11/rails-printing-validation-errors-as-flash-notices.html title="Previous: Rails: Printing validation errors as flash notices">&#171; Older</a></div>
<div class=nav-center><a href=/>Top</a> | <a href=/archive/>Archive</a></div>
<div class=nav-right><a href=/2006/12/29/rails-staying-away-from-enums-in-migrations.html title="Next: Rails: Staying away from Enums in Migrations">Newer &#187;</a></div>
</nav>
</main>
</div>
<footer class=page-footer>
<div id=copyrights>&#169; 2002-2022 Erin Schnabel</div>
<div class=icons>
<a target=_blank href=https://github.com/ebullient title="ebullient on GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</a>
<a target=_blank rel=me href=https://mastodon.social/@ebullient title="Follow @ebullient"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
</a>
<a target=_blank href=https://twitter.com/ebullientworks title="Follow @ebullientworks"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
</a>
<a target=_blank href=https://www.linkedin.com/in/erinschnabel/ title="Erin Schnabel on linked.in"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1.0 83.5.0 53.8a53.79 53.79.0 01107.58.0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29.0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"/></svg>
</a>
<a target=_blank href=/index.xml title=Subscribe><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328.0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765.0 183.105.0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686.0 38.981.0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"/></svg> </a>
</div>
</footer>
</body>
</html>