<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link rel=stylesheet href=/blog.css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><title>Posts</title><link rel=canonical href=/posts.html><link rel=alternate type=application/rss+xml href=/posts/index.xml title=ebullient·works></head><body><div class=wrapper><header class=page-header><h1><a href=/>ebullient·works</a></h1><div>[ <a href=/about/>About</a> &#183; <a href=/archive/>Archive</a> ]</div></header><h1>Posts</h1><article><h2>Metrics for the win! at J4K Conference</h2><p>A longer form of Metrics for the Win! recorded for J4K, which occurred in
October of 2020.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/emOBXgDZ9Pc style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div></article><article><h2>D&D and Metrics: an unexpected journey</h2><p>I was asked, based solely on the abstract for my 2020 DevNexus talk, if I would be interested in writing an article on the topic. I agreed. The resulting article was published in Germina, in the September 2020 issue of <a href=https://kiosk.entwickler.de/java-magazin/java-magazin-9-2020/dungeons-dragons/>Java Magazin</a>, with &ldquo;Dungeons and Dragons&rdquo; as the title. I have a lovely hard-copy in my office.</p><p>The English version has also now been published at <a href=https://jaxenter.com/metrics-dnd-173311.html>JaxEnter</a>, &ldquo;Monsters in combat: exploring application metrics with D&D&rdquo;.</p><p>I hope you enjoy it.</p></article><article><h2>Metrics for the win! at JConf</h2><p>A fully online recorded talk, sliding in at just 30 minutes, for JConf in the
fall of 2020.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/YK4e3wefqWY style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div></article><article><h2>Hugo with markdown and asciidoc</h2><p>All done!</p><p>Building on <a href=/2020/01/08/from-jekyll-and-gitbook-to-hugo-and-asciidoc-care-of-github-actions.html>the previous post</a>, here is a summary of what I had to do to collapse two sites (one a date-oriented blog, and the other an outline-based gitbook) into a single site.</p><p>I loathe maintaining dates inside of files. As a customization, hugo is configured to lift the date from the file name first, then git data, and only after those two have been tried will it fall back to dates in the file header:</p><div class=highlight><pre style=-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>frontmatter:<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span style=color:#bbb>  </span>date:<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span style=color:#bbb>    </span>-<span style=color:#bbb> </span><span style=color:#ba2121>&#34;:filename&#34;</span><span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span style=color:#bbb>    </span>-<span style=color:#bbb> </span><span style=color:#ba2121>&#34;:git&#34;</span><span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span style=color:#bbb>    </span>-<span style=color:#bbb> </span><span style=color:#ba2121>&#34;:default&#34;</span><span style=color:#bbb>
</span></code></pre></div><p>The permalink structure for blog posts is also explicitly configured to match the URL pattern used by Jekyll:</p><div class=highlight><pre style=-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>permalinks:<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span style=color:#bbb>  </span>posts:<span style=color:#bbb> </span>/:year/:month/:day/:slug<span style=color:#bbb>
</span></code></pre></div><p>To preserve previous links, I'm also using ugly URLs!</p><div class=highlight><pre style=-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>uglyURLs:<span style=color:#bbb> </span><span style=color:green;font-weight:700>true</span><span style=color:#bbb>
</span></code></pre></div><p>I am also generally unbothered about having a <code>.html</code> extension on pages. These are static html files after all. This does require index files to fix top-level section behavior, as described below.</p><p>I almost never use pre-defined themes. Call me picky, or whatever, but I prefer defining resources that behave the way I want them to. For hugo, this means creating layouts and supporting files.</p><h2 id=blog-posts--markdown>Blog posts / markdown</h2><p>For the blog, I used a &ldquo;posts&rdquo; layout. Which means the header for blog entries minimally contains the following:</p><div class=highlight><pre style=-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>---<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span style=color:#bbb></span>layout:<span style=color:#bbb> </span>post<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span style=color:#bbb></span>title:<span style=color:#bbb> </span>...<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span style=color:#bbb></span>author:<span style=color:#bbb> </span>...<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span style=color:#bbb></span>---<span style=color:#bbb>
</span></code></pre></div><p>Specifying the layout in this way tells hugo to look for files in <code>layouts/posts</code>. I have two files defined there, one for the list of blog entries (<a href=https://github.com/gameontext/gameontext-docs/blob/to-hugo/site/layouts/posts/list.html>list.html</a>), and one for each entry (<a href=https://github.com/gameontext/gameontext-docs/blob/to-hugo/site/layouts/posts/post.html>post.html</a>). The contents for these two templates are pretty standard fare, and take advantage of hugo's support for sections to create navigation between posts. This allows the date-based URL space to remain distinct from the book pages.</p><p>The posts directory contains an <code>_index.md</code> file that assigns the list of blog posts to the <code>/blog/</code> path:</p><div class=highlight><pre style=-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>---<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span style=color:#bbb></span>title:<span style=color:#bbb> </span><span style=color:#ba2121>&#34;Blog: Events and other (mis-)adventures&#34;</span><span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span style=color:#bbb></span>url:<span style=color:#bbb> </span><span style=color:#ba2121>&#34;/blog/&#34;</span><span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span style=color:#bbb></span>---<span style=color:#bbb>
</span></code></pre></div><h2 id=gitbook--asciidoc>GitBook / asciidoc</h2><p>Managing book pages was a little more challenging. The book sprawled across multiple directories as a hierarchy of topics. The gitbook display format also included a TOC along the left side, which I was going to need to emulate one way or the other.</p><p>In this case, I opted to define a type:</p><div class=highlight><pre style=-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>---<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span style=color:#bbb></span>title:<span style=color:#bbb> </span>...<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span style=color:#bbb></span>weight:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span style=color:#bbb></span>type:<span style=color:#bbb> </span>book<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span style=color:#bbb></span>---<span style=color:#bbb>
</span></code></pre></div><p>The default sorting mechanism in hugo uses the page weight first. By explicitly specifying the weight, I can control the order of the pages in the book, which is tiresome, but also exactly what I want.</p><p>This yaml metadata needs to be present at the top of all files, both section indexes and asciidoc content. The type similarly instructs hugo to look for layout pages in a <code>book</code> subdirectory, for either <a href=https://github.com/gameontext/gameontext-docs/blob/to-hugo/site/layouts/book/list.html>lists</a> or individual <a href=https://github.com/gameontext/gameontext-docs/blob/to-hugo/site/layouts/book/single.html>pages</a>.</p><p>Navigation was a real challenge, as links within a section weren't going to be enough.</p><p>For list pages, I ended up with a layout that would either use a <a href=https://github.com/gameontext/gameontext-docs/blob/to-hugo/site/layouts/partials/section-index.html>partial</a> to recursively list all content (used by the <code>/about/</code> section), or would list all the pages in the current section followed by a list of all top-level sections including subsections of the current section. Sounds complicated, and it kind of is, but it provides reasonable navigavtion between sections, and that's important.</p><p>Navigation for pages was also laborious. I created another <a href=https://github.com/gameontext/gameontext-docs/blob/to-hugo/site/layouts/partials/prevnext-section.html>partial</a> to navigate to the previous or next page in the current section. If there wasn't a previous or next page in the section, it links to the previous or next section instead.</p><p>Both of the partials use <code>.Scratch</code> to propagate context between scopes. Somewhat annoyingly previous and next were inverted. I could have gone back and adjusted all the page weights so the pages sorted into reverse order, or just flipped the link. Numbering from 1 to whatever makes more sense, so I flipped the links. I am sure this will confuse future me at some point.</p><p>Anyway, maybe someone will find all of that cleverness useful.</p></article><article><h2>From Jekyll and GitBook to Hugo and Asciidoc, care of Github Actions</h2><p>This won't be a super chatty post. We have two websites for Game On! (our microservices text adventure): a jekyll-based markdown blog and a legacy-gitbook-based asciidoc book. For various reason, I want to combine them,and I woukd rather not spend gobs of time converting between markdown and asciidoc.</p><p>To keep things quick: I knew I wanted a static site generator, and I've used hugo before and found it fast, straight-forward and unconfusing. So in my mind, I'd already picked hugo.</p><p>I found these two posts on hugo with asciidoc:</p><ul><li><a href=http://ratfactor.com/hugo-adoc-html5s/>Better Hugo/AsciiDoc HTML</a></li><li><a href=https://blog.anoff.io/2019-02-17-hugo-render-asciidoc/>Get Hugo to render (nice) Asciidocs</a></li></ul><p>The second references the first. The first is also referenced in a git issue about some issues with how hugo invokes external helpers like asciidoc. The bottom line is that I can use hugo to do what I want, but there are some tricks required to influence how asciidoc is invoked to get better output.</p><h2 id=thinking-about-deployment>Thinking about deployment</h2><p>The existing two sites use Travis. They've existed so long (and have been running so well) that I forgot how to set them up. And, in the interim, the travis-ci.org vs. travis-ci.com shift has happened, and for one of the repos in particular, it feels like the settings have disappeared entirely. So. I can either figure out what happened with Travis and set that up again, or go fiddle with the new shiny thing, GitHub Actions.</p><p>The new shiny toy won because of these two actions:</p><ul><li><a href=https://github.com/peaceiris/actions-hugo>peaceiris/actions-hugo</a></li><li><a href=https://github.com/peaceiris/actions-gh-pages>peaceiris/actions-gh-pages</a></li></ul><p>These two actions (found easily in the marketplace) are well-documented and do exactly what I want. I will likely fork/clone/copy them over time, but it was nice to just see them already there.</p><p>At this point, I'm nowhere near ready for deployment, so I haven't done much with the second. I used the first to start putting together a workflow that builds a new hugo-based site, with baby steps: First set-up hugo, then set up asciidoc with the tweaks noted above.</p><p>So far, this experiment looks like this:</p><div class=highlight><pre style=-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span>name:<span style=color:#bbb> </span>publish<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span style=color:#bbb></span>on:<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span style=color:#bbb>  </span>push:<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span style=color:#bbb>    </span>branches:<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span style=color:#bbb>    </span>-<span style=color:#bbb> </span>hugo<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span style=color:#bbb></span>jobs:<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span style=color:#bbb>  </span>build:<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span style=color:#bbb>    </span>runs-on:<span style=color:#bbb> </span>ubuntu-latest<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span style=color:#bbb>    </span>steps:<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span style=color:#bbb>    </span>-<span style=color:#bbb> </span>name:<span style=color:#bbb> </span>check<span style=color:#bbb> </span>out<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span style=color:#bbb>      </span>uses:<span style=color:#bbb> </span>actions/checkout@v1<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span style=color:#bbb>    </span>-<span style=color:#bbb> </span>name:<span style=color:#bbb> </span>Setup<span style=color:#bbb> </span>ruby<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span style=color:#bbb>      </span>uses:<span style=color:#bbb> </span>actions/setup-ruby@v1<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span style=color:#bbb>      </span>with:<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span style=color:#bbb>        </span>ruby-version:<span style=color:#bbb> </span><span style=color:#ba2121>&#39;2.x&#39;</span><span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span style=color:#bbb>    </span>-<span style=color:#bbb> </span>name:<span style=color:#bbb> </span>Setup<span style=color:#bbb> </span>Asciidoctor<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span style=color:#bbb>      </span>run:<span style=color:#bbb> </span><span style=color:#ba2121;font-style:italic>|
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span style=color:#ba2121;font-style:italic>       </span><span style=color:#ba2121;font-style:italic> </span><span style=color:#ba2121;font-style:italic>gem install asciidoctor</span><span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span style=color:#bbb>        </span>gem<span style=color:#bbb> </span>install<span style=color:#bbb> </span>asciidoctor-html5s<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span style=color:#bbb>        </span>gem<span style=color:#bbb> </span>install<span style=color:#bbb> </span>asciidoctor-diagram<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span style=color:#bbb>        </span>.<span style=color:#bbb> </span>./wrap_asciidoc.sh<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span style=color:#bbb>        </span>asciidoctor<span style=color:#bbb> </span>--version<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span style=color:#bbb>    </span>-<span style=color:#bbb> </span>name:<span style=color:#bbb> </span>Setup<span style=color:#bbb> </span>Hugo<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span style=color:#bbb>      </span>uses:<span style=color:#bbb> </span>peaceiris/actions-hugo@v2<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span style=color:#bbb>      </span>with:<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span style=color:#bbb>        </span>hugo-version:<span style=color:#bbb> </span><span style=color:#ba2121>&#39;0.62.2&#39;</span><span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span style=color:#bbb>    </span>-<span style=color:#bbb> </span>name:<span style=color:#bbb> </span>Build<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span style=color:#bbb>      </span>run:<span style=color:#bbb> </span><span style=color:#ba2121;font-style:italic>|
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span style=color:#ba2121;font-style:italic>       </span><span style=color:#ba2121;font-style:italic> </span><span style=color:#ba2121;font-style:italic>export PATH=$PWD/bin:$PATH</span><span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span style=color:#bbb>        </span>which<span style=color:#bbb> </span>asciidoctor<span style=color:#bbb>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span style=color:#bbb>        </span>hugo<span style=color:#bbb> </span>--minify<span style=color:#bbb>
</span></code></pre></div><p>I defined one custom script (<code>wrap_asciidoc.sh</code>) used in the &lsquo;Setup asciidoctor&rsquo; step to create a wrapper script to add required arguments when <code>hugo</code> makes the syscall to invoke asciidoctor. The path is updated in the &lsquo;Build&rsquo; step to ensure the customized asciidoc script is used by <code>hugo</code>.</p><p>Take a look at <a href="https://github.com/gameontext/gameontext.github.io/commit/21f8594e9570b42ed21ae2118cf79853d2b405c1/checks?check_suite_id=391257554">the build output for these steps</a></p><p>I'll stop here for now. The next bit of work is all about setting up the base set of templates I'll need.</p></article><article><h2>Scripts for the win! Updating git repositories for the lazy.</h2><p>I love scripts! I treat them as my extended memory. Blog posts used to do this,
but life and children have eaten up the capacity I used to have for writing.</p><p>But I thought I would share my latest script for the lazy (which I have now duplicated several times. I know, I know. WET, DRY. I can't be bothered). This script iterates over all of the git repositories in a sub-directory (where I have several related ones), fetches everything, fast-forwards if it can, and otherwise tries to rebase on the upstream branch if there is one that matches.</p><p>There is an extra case statement at the bottom as I inevitably extend this to do
more things specific to this group of projects. This kind of approach grew out
of the scripts written for Game On!, which still work well, and do their extra
duty reminding me what on earth I was doing the last time I worked on it.</p><pre><code>#!/bin/bash
script_dir=$( cd &quot;$( dirname &quot;${BASH_SOURCE[0]}&quot; )&quot; &amp;&amp; pwd )
orig_dir=${PWD}
cd ${script_dir}

if [ -x /usr/bin/tput ] &amp;&amp; [[ `tput colors` != &quot;0&quot; ]]; then
  color_prompt=&quot;yes&quot;
elif [ -x /ffp/bin/tput ] &amp;&amp; [[ `tput colors` != &quot;0&quot; ]]; then
  color_prompt=&quot;yes&quot;
else
  color_prompt=
fi

if [[ &quot;$color_prompt&quot; == &quot;yes&quot; ]]; then
      BLUE=&quot;\033[0;34m&quot;
    GREEN=&quot;\033[0;32m&quot;
    WHITE=&quot;\033[1;37m&quot;
      RED=&quot;\033[0;31m&quot;
    YELLOW=&quot;\033[0;33m&quot;
  NO_COLOR=&quot;\033[0m&quot;
else
        BLUE=&quot;&quot;
      GREEN=&quot;&quot;
      WHITE=&quot;&quot;
        RED=&quot;&quot;
  NO_COLOUR=&quot;&quot;
fi

note() {
  echo -e &quot;${BLUE}$@${NO_COLOR}&quot;
}

pushd () {
  if ! command pushd &quot;$@&quot; &gt; /dev/null; then
    note &quot;$@ does not exist&quot;
    exit
  fi
}

popd () {
  command popd &quot;$@&quot; &gt; /dev/null
}

update() {
  for x in $(find . -d -maxdepth 1 -mindepth 1 -type d); do
    note &quot;-- $x&quot;;
    pushd $x;
    if [ -d .git ]; then
      git fetch --all --prune;
      if git status | grep &quot;fast-forward&quot;
      then
        note &quot;fast-forwarding $x&quot;;
        git pull
      fi
      if git remote | grep 'ebullient'; then
        local branch=$(git branch --show-current)
        if git branch -a | grep &quot;remotes/upstream/${branch}&quot;; then
          note &quot;rebasing ebullient fork on upstream/${branch}&quot;
          git rebase upstream/${branch} &amp;&amp; git push
        fi
      fi
    fi
    popd
  done
}

#set the action, default to help if none passed.
ACTION=
if [ $# -ge 1 ]; then
  ACTION=$1
  shift
fi

case &quot;${ACTION}&quot; in
  alias)
    echo &quot;alias qk='${script_dir}/qk.sh'&quot;
  ;;
  git)
    update
  ;;
  *)
    update
  ;;
esac
</code></pre></article><article><h2>Monsters and Metrics at SpringOne 2019</h2><p>Two things collided in my brain this year ahead of SpringOne: Preparing a new talk from scratch covering the Micrometer (and the related Spring implementation), and learning everything I needed to know to be a Dungeon Master for my 10-year-old son and his friends.</p><p>Thanks to a brilliant suggestion from a friend, these two things collided in the talk, too. Which lightened the mental load (or at least reduced the amount of full stack swapping going on).</p><p>Github repository: <a href=https://github.com/ebullient/monster-combat>ebullient/monster-combat</a> with Spring Boot 2, WebFlux, and Micrometer</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/_Vg4J9cdO6s style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div></article><article><h2>Debug gulp</h2><p>A gulp build unhelpfully finished with:</p><pre><code>(node:12030) UnhandledPromiseRejectionWarning: null
(node:12030) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). (rejection id: 1)
(node:12030) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.
</code></pre><p>I needed to change both my gulpfile and my IDE to be able to follow what
was happening.</p><p>I added this rejection handler to my gulpfile first:</p><div class=highlight><pre style=-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>process.on(<span style=color:#ba2121>&#39;unhandledRejection&#39;</span>, (reason, p) =&gt; {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>  console.log(<span style=color:#ba2121>&#39;Unhandled Rejection at: Promise&#39;</span>, p, <span style=color:#ba2121>&#39;, reason:&#39;</span>, reason);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>});
</code></pre></div><p>which netted me this:</p><pre><code>Unhandled Rejection at: Promise Promise {
  &lt;rejected&gt; null,
  domain:
   Domain {
     domain: null,
     _events: { error: [Object] },
     _eventsCount: 1,
     _maxListeners: undefined,
     members: [] } } reason: null
</code></pre><p>Not much better.</p><p>Let's try debugging gulp! How do I do that again?</p><p>In VS Code, let's create a debug configuration that is brain-bashingly simple. Add this to launch.json:</p><div class=highlight><pre style=-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>  {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>    <span style=color:green;font-weight:700>&#34;type&#34;</span>: <span style=color:#ba2121>&#34;node&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>    <span style=color:green;font-weight:700>&#34;request&#34;</span>: <span style=color:#ba2121>&#34;attach&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span>    <span style=color:green;font-weight:700>&#34;name&#34;</span>: <span style=color:#ba2121>&#34;Attach to Remote&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span>    <span style=color:green;font-weight:700>&#34;address&#34;</span>: <span style=color:#ba2121>&#34;127.0.0.1&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span>    <span style=color:green;font-weight:700>&#34;port&#34;</span>: <span style=color:#666>9229</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span>    <span style=color:green;font-weight:700>&#34;localRoot&#34;</span>: <span style=color:#ba2121>&#34;${workspaceFolder}/resources&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span>    <span style=color:green;font-weight:700>&#34;remoteRoot&#34;</span>: <span style=color:#ba2121>&#34;Absolute path to the remote directory containing the program&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span>  }
</code></pre></div><p>Now launch gulp with some options. I'm using <code>npx</code> here because I detest <code>npm install -g</code>:</p><pre><code>$ npx -n --inspect-brk gulp build
</code></pre><p>This process will now wait until VS Code attaches. When the debugger attaches, check the &ldquo;Uncaught Exceptions&rdquo; box in the breakpoint section of the debug panel.</p><p>Press play, and .. there it is. A much clearer picture of what tipped over. I feel so much better.</p><p>(Hope this helps, future self)</p></article><article><h2>What is a Cloud Native application, anyway?</h2><p>This is my first attempt at talking about what is going on with Cloud Native applications these days. Given at IndexConf in San Francisco.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/28r4H_xWPPo style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div></article><article><h2>Doing the scary thing: Mainstage at SpringOne</h2><p>I will absolutely confess that it was daunting to start with, but that once I was out on the stage, everything was fine.</p><p>I will also confess to ad nauseum rehearsal. To reciting what I had to cram into two segments (one only 2 minutes long, and the other 2 minutes and 30 seconds) to every inanimate object in my hotel room: lamps, laptops, mirrors, showerheads, and I'm pretty sure my pillow while I was sleeping.</p><p>I didn't really wrap my head around what I wanted to say until the night before. Things just didn't fall into place before then. But hey, I lived! It was quite the experience.</p><blockquote class=twitter-tweet><p lang=en dir=ltr>Watch the <a href="https://twitter.com/hashtag/SpringOne?src=hash&ref_src=twsrc%5Etfw">#SpringOne</a> mainstage lightning talks on Distributed Systems, featuring <a href="https://twitter.com/cdavisafc?ref_src=twsrc%5Etfw">@cdavisafc</a>, <a href="https://twitter.com/meaghnk?ref_src=twsrc%5Etfw">@meaghnk</a>, <a href="https://twitter.com/midatlantictez?ref_src=twsrc%5Etfw">@midatlantictez</a>, <a href="https://twitter.com/ebullientworks?ref_src=twsrc%5Etfw">@ebullientworks</a>, and Mathangi Venkatesan. <a href=https://t.co/PVxlz1ta5V>https://t.co/PVxlz1ta5V</a></p>&mdash; VMware Tanzu (@VMwareTanzu) <a href="https://twitter.com/VMwareTanzu/status/941051353761288192?ref_src=twsrc%5Etfw">December 13, 2017</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script></article><article><h2>Java EE ebullience — airhacks.fm podcast with Adam Bien</h2><p>I spent an excellent few hours recording a podcast with Adam Bien.</p><p>CORBA? OpenLiberty? Robots? The glory days of object marshaling? Such a trip down memory lane! We could easily have talked for another hour.</p><p>Can you hear my rings clinking on my favorite mug? Yes, yes you can.</p><p>Give it a listen: <a href=https://s3.eu-central-1.amazonaws.com/airhacks.fm/airhacksfm_3.mp3>Java EE ebullience</a>.</p></article><article><h2>Git with edit on an iPad?</h2><p>We shall see how this goes over time, but so far? Oh hell yes.</p><p>I am experimenting with a cute little app (I have, sad to say, fallen head over feet into the Apple ecosystem. Other devices might seem cool, but not worth the gymnastics. Ecosystem stickiness is a thing.) that allows me to edit. code. from. my. iPad.</p><p>Why would I want to do that?</p><ul><li>Device junky that I am, I totes splurged and got an iPad Pro, with its little keyboard.</li><li>I would really really really like to make more entries to this blog, for example. This is a nice alternative to hauling laptop around.</li><li>I want to see how far I can push this über tiny device thing, that ALSO happens to have a stylus (yes, I am one of those people that thinks better long-hand).</li></ul><p>So exciting!</p><p>The one challenge with this, in particular, is that I can’t get the Jekyll preview that I could if I were running locally. The iPad Pro is quite the workhorse&mldr; but it doesn’t (yet, ha!) run Docker containers.</p><p>Oh, right. The app: <a href=https://workingcopyapp.com>Working Copy</a>. It also integrates with <a href=https://ioctocat.com>iOctocat</a>.</p></article><article><h2>Jekyll templates with Docker containers</h2><p>It took me a few tries (divided attention, grr), but I realized that after messing with blogs for over 10 years, I've seen all the things! Way back in the beginning was Movable Type (which I didn't realize was still a thing), followed by PHP-based CMS like Textpattern and Nucleus CMS, and then a brief flirtation with Blogger (someone made me do it). I have somehow avoided ever having to maintain templates for WordPress (?!). These systems all come back to some pretty basic concepts around templating.</p><p>The one snag was loathing having to do anything with ruby. I have never had anything but grief and pain installing ruby anywhere. But hey! We have docker now! Put it in a container and forget about it. WOOT!</p><p>I had to cheat a little bit (but only a little), because you have a chicken and egg problem if you're creating a Jekyll blog from scratch. You can use the source docker image for that, per <a href=https://github.com/jekyll/docker/wiki/Usage:-Running>Jekyll Docker Usage: Running</a>:</p><ul><li><p>Create a new jekyll site:</p><pre><code>docker run --rm --label=jekyll --volume=$(pwd):/srv/jekyll \
       -it -p 127.0.0.1:4000:4000 jekyll/jekyll:pages jekyll new .
</code></pre></li><li><p>Serve content:</p><pre><code>docker run --rm --label=jekyll --volume=$(pwd):/srv/jekyll \
       -it -p 127.0.0.1:4000:4000 jekyll/jekyll jekyll serve
</code></pre></li></ul><p>You get the idea. The <code>docker-compose.yml</code> file makes it easy to set up the container with the mounted volume without thinking about it. Then edit away, and watch your blog rebuild. Not too shabby.</p><p><em>2017-09-12 Edit:</em> At some point, to make life easier, the listening host inside the container was set to 0.0.0.0. I've also added some tricks to allow one container to build/update dependencies before my custom project container serves</p><p>Docker files for running jekyll without hurting yourself:</p><ul><li>[docker-compose.yml]({{ &lsquo;/files/2017-04-jekyll/docker-compose.yml&rsquo; | relative_url }})</li><li>[Dockerfile]({{ &lsquo;/files/2017-04-jekyll/Dockerfile&rsquo; | relative_url }})</li></ul><h2 id=templates-with-flexbox-css>Templates with Flexbox (CSS)</h2><p>I browsed through a bunch of templates, and decided pretty early that they were all more complicated than I thought was necessary. The most significant non-standard thing for the Game On! blog is that there are multiple authors, and that those authors must be described in a certain way to make the generated atom/RSS feed happy (yes, I looked).</p><p>I went back to basics and built the templates up from scratch. I used flexbox, both on the Game On! blog and on my own, for a nice, fluid, responsive UI with minimal HTML (because really, who wants to maintain all those crap filler tags anyway? You're right, not me). There was a lot of cutting and pasting as there are only so many ways to write a <a href=https://jekyllrb.com/docs/templates/>Liquid</a> template to show an index of all Jekyll posts, but in the end, a lot was left on the cutting room floor.</p><h2 id=dealing-with-tags-and-no-plugins>Dealing with Tags (and no plugins)</h2><p>I like tag indexes, as I use tags a lot. There are a few posts about how to manage a tag index with jekyll and no plugins (important if you're hosting on github, which I am). Some of them require interesting manual update steps to create individual files per tag, which I think is pretty ick to maintain. At least one Atom plugin aims to help with maintaining files for tags, but.. meh. Maybe someday.</p><p>For right now, I cheated / went low-tech. You get one page that indexes the posts by tag (where the post might be on there multiple times, but whatever).</p><ul><li><a href=ttps://github.com/ebullient/ebullient.github.io/tree/master/_pages/tag.html>Archive by tag</a></li></ul><h2 id=the-result>The result</h2><p>Well, you're looking at it! One thing sacrificed on my blog is a twitter feed. I'm not sure I care all that much. My twitter feed has been taken over by politics anyway. :sigh:</p><ul><li>Game On! <a href=https://github.com/gameontext/gameontext.github.io/tree/master/_layouts>layouts</a>, and <a href=https://github.com/gameontext/gameontext.github.io/tree/master/_includes>includes</a></li><li>ebullient·works <a href=https://github.com/ebullient/ebullient.github.io/tree/master/_layouts>layouts</a>, <a href=https://github.com/ebullient/ebullient.github.io/tree/master/_includes>includes</a>, and <a href=https://github.com/ebullient/ebullient.github.io/tree/master/_pages>pages</a></li></ul><h2 id=blog-behavior-crossed-with-dns-whats-in-a-name>Blog behavior crossed with DNS: what's in a name?</h2><p>One thing I enjoyed stumbling was a <a href=https://www.netlify.com/blog/2017/02/28/to-www-or-not-www/>blog post from netlify</a> discussing whether you should, or shouldn't be running your blog from the apex domain. I confess they changed my mind, and now my blog is running at <a href=http://www.ebullient.dev/>http://www.ebullient.dev/</a>!</p><p>References:</p><ul><li><a href=http://davidensinger.com/2013/11/building-a-better-sitemap-xml-with-jekyll/>Google WebTools compatible sitemap</a></li><li><a href=https://www.netlify.com/blog/2017/02/28/to-www-or-not-www/>To WWW or not WWW</a> <span class=attribute>[<a href=https://www.netlify.com/>https://www.netlify.com/</a>]</span></li></ul><p>Things to look at next:</p><ul><li><a href=http://kylebebak.github.io/post/tags-categories-jekyll>Using a git commit hook for tags</a></li><li>Simplify CSS: use more Sass tricks</li></ul></article><article><h2>From then to now.. blogs over 12 years</h2><p>Yes, I confess, I did .. umm.. censor my blogs over the years. When facebook arrived, blog posts about nasty headaches and reactions to the latest headlines could all go away. The exodus of content continued with the advent of Twitter. Which left this blog, which I've tended on and off for close to 14 years, in the lurch!</p><p>There is also the small matter of how much time I have to spend on blog posts between work, kids, and this mammoth garden we have going in the back yard. The mammoth garden is totally my fault, we started it as an excuse to get me <em>outside</em>. It worked.</p><p>However, it has become obvious that a return to blogging is overdue. To start with, Game On! needed a blog! We kept having little tidbits to share, that needed a home. I made an initial foray into creating a blog with Jekyll to build a <a href=http://blog.gameontext.org>new blog for Game On!</a>. I kind of liked how that worked, AND it meant I could stop having to edit posts via the web, and so I've now brought that to my own blog, too.</p><p>Next post: the jekyll stuff.</p></article><article><h2>Game On! Explore microservices with a text-based adventure</h2><p>Microservices: the buzz is everywhere. Given the breadth of technologies related to the term, it can be difficult to get a full picture of what a Microservices architecture should look like, or to understand why it is said that microservices architectures both remove and introduce complexity at the same time. <a href=https://gameontext.org>Game On!</a> is a throwback text-based adventure built to help you explore microservices concepts.</p><p><a href=https://developer.ibm.com/wasdev/blog/2016/05/04/game-explore-microservices-text-based-adventure/>Continue with post on <span class=caps>IBM</span> developerWorks</a></p></article><article><h2>Swagger-first API design</h2><p>I've been working for the past few months on building Game On! a microservices-based application that is intended to show both what a microservices architecture looks like, and to make it easy for people to play with such a system without having to start from the ground up themselves.</p><p>We started with a best-guess set of services, and over time, it became pretty apparent that our first pass at a map building service (the Concierge) was both misleading in purpose and insufficient in function. It did serve its purpose, filling in for service discovery in a way, but we were growing beyond what the service could do.</p><p>I'm more familiar with Java than anything else, so I built the new Map <span class=caps>API</span> using <span class=caps>JAX</span>-RS and Liberty, but I also tried something new. In the beta drivers released in late 2015, Liberty added an <span class=caps>API</span> Discovery feature, which allows automatic generation of Swagger documentation from <span class=caps>JAX</span>-RS and Swagger annotations in the application.</p><p>I set up the new Map service using the beta driver and this beta feature, and started creating the skeleton elements that would form the <span class=caps>API</span> in Eclipse with <span class=caps>WDT</span>. As I made changes to the application files, all I had to do was refresh the browser to see an updated view of my <span class=caps>API</span>.</p><p><img src=/images/11t.png title="WAS Liberty API Discovery feature" alt="WAS Liberty API Discovery feature"></p><p>I really liked working this way: I could get a better feel of the usability of the <span class=caps>API</span> because I could see the whole view in one place. It also meant I was building up a useful set of models that I could then use with Jackson to streamline dealing with <span class=caps>JSON</span> payloads.</p></article><article><h2>Shell prompt crazy for Git Submodules</h2><p>I've run a somewhat odd little script to generate my command prompt for years now, sets some colors, adds some indicators of what kind of shell I'm in (sudo or tmux/screen or ssh or.. ).</p><p>Given I now have to work with git and submodules, I've revised that to include information provided about git generated by this script: <a href=https://github.com/git/git/blob/master/contrib/completion/git-prompt.sh>https://github.com/git/git/blob/master/contrib/completion/git-prompt.sh</a></p><p>The difference is worth it, in understanding at a glance what is going on without typing <code>git status</code> or variant every two seconds. ;)</p><p>I've also been using some very useful aliases to make working with submodules sane, as documented here: <a href=https://book.gameontext.org/walkthroughs/git.html>Game On! Advanced Adventures / Git Submodules</a></p></article><article><h2>Microservices and WAS Liberty</h2><p>Home to Microservices and <span class=caps>WAS</span> Liberty resources, which provide background information, getting started guidance, best practices, and methodologies.</p><p><a href=https://developer.ibm.com/wasdev/docs/microservices/>Continue with post on <span class=caps>IBM</span> developerWorks</a></p></article><article><h2>Trying to tell the human story...</h2><p>Writing is always hard. Writing technical stuff is hard. Writing technical stuff that doesn't sound like it is a regurgitated text book&#8230; <strong>sigh</strong></p><p>I've been leading a team working on or with Microservices at <span class=caps>IBM</span> (lots of people everywhere are doing things with microservices, this should come as no surprise). We've been specifically looking at how to modernize an existing Java EE application. There are articles about this, but they are all formal, and (to me) preachy.</p><p>We're doing the experiment live, so to speak. Taking the crufty Plants By WebSphere application and pulling it apart bit by bit. Our aim is to make sure you have a functional application at all times, and to frankly just share our thoughts as we try it. Let us know what you think.</p><p>Blog posts (there will be more):<ul><li><a href=https://developer.ibm.com/wasdev/blog/2015/11/13/monolithic-jee-app-microservices-rules-engagement/>Rules of Engagement</a></li><li><a href=https://developer.ibm.com/wasdev/blog/2015/11/20/evolving-java-ee-applications-microservices-start/>Getting started</a></li></ul></p><p>Articles (longer lived, some procedure):<ul><li><a href=https://developer.ibm.com/wasdev/docs/starting-evolution-microservices-using-plants-websphere-sample/>Decomposition</a></li><li><a href=https://developer.ibm.com/wasdev/docs/evolved-image-service-plants-websphere/>Choosing a candidate</a></li><li><a href=https://developer.ibm.com/wasdev/docs/an-evolved-plants-by-websphere-image-service-making-the-break/>Breaking the candidate out into its own microservice</a></li></ul></p></article><article><h2>Which gradle...</h2><p>I am lazy. My fingers have habits that are sometimes hard to change.</p><p>I've learned to type <code>gradle</code>, like all the time. Now I need to use <code>gradlew</code>, and for some reason this is difficult.</p><p>So I wrote a script, that I've now aliased (whichGradle is now obviously on my path):<br>alias gradle='whichGradle'</p><p>which just does this:</p><pre class=bigblock><code>if [ -x $PWD/gradlew ]; then
  echo Using $PWD/gradlew
  $PWD/gradlew $@
else
  echo Using `which gradle`
  gradle $@
fi
</code></pre></article><article><h2>Secure Microservices: API Keys, Access Tokens, and Signed JWTs</h2><p>Some samples demonstrating how to secure your microservices using <span class=caps>API</span> keys, access tokens, and <span class=caps>JSON</span> Web Tokens (<span class=caps>JWT</span>s).</p><p><a href=https://developer.ibm.com/wasdev/blog/2015/12/04/secure-microservices-api-keys-access-tokens-signed-jwts/>Continue with post on <span class=caps>IBM</span> developerWorks</a></p></article><article><h2>Using Grok filters to parse Liberty Logs</h2><p>Logstash is a core part of the <span class=caps>ELK</span> stack that can be used to pull and tag content in <span class=caps>WAS</span> Liberty logs. This post walks through how to configure Logstash to collect and format <span class=caps>WAS</span> Liberty logs.</p><p><a href=https://developer.ibm.com/wasdev/docs/logstash-liberty-optimizing-data-collection-cloud/>Continue with post on <span class=caps>IBM</span> DeveloperWorks</a></p></article><article><h2>Docker script for AnyConnect on OSX</h2><p>I am queen of laziness, and I have to use AnyConnect, and that screws with Docker, and then I have to go looking to remember the magic incantation to get things right...</p><p>Who has time for that?</p><p>I made a script that wraps the whole thing up and reminds me what I should do when it doesn't work.</p><p>Instead of:<br><code>> docker-machine env default</code><br>I do this instead, and the script does the rest:<br><code>> . dockerEnv</code></p><p>The contents of the script are pretty trivial (I am sure shell wizards can find plenty wrong with it, starting with the direct reference to bash, but whatever. Laziness, right?):</p><pre><code>#!/bin/bash
UP=`docker-machine status default`
if [ "$UP" != "Running" ] ; then
    echo "Starting default docker VM"
    docker-machine start default
fi

eval "$(docker-machine env default)"
export DM_IP=$(docker-machine ip default)
echo $DM_IP

DM_SUBNET=192.168.$(echo $DM_IP| cut -d'.' -f 3)
RESULT=`netstat -rn | grep $DM_SUBNET | grep vboxnet`
if [ "$RESULT" = "" ] ; then
    echo "Adding route for vboxnet0"
    sudo route -nv add -net $DM_SUBNET -interface vboxnet0
    RESULT=`netstat -rn | grep $DM_SUBNET | grep vboxnet`
    if [ $RESULT = "" ] ; then
        echo "Quit AnyConnect and re-run this script."
        exit
    fi
fi
docker-machine ls
</code></pre><p class=small>[edit on 3 Sept: updated for even better-ness. Laziness rocks.]</p></article><article><h2>Don't Wait! Play with Async EE7 instead</h2><p>An overview of what Java EE 7 brings in support of responsive applications with samples on GitHub. These samples were also used at <span class=caps>IBM</span> InterConnect earlier in the year.</p><p><a href=https://developer.ibm.com/wasdev/blog/2015/08/21/dont-wait-build-responsive-applications-java-ee7-liberty/>Continue with post on <span class=caps>IBM</span> DeveloperWorks</a></p></article><article><h2>Building portable, 12-factor microservices with WAS Liberty and Bluemix</h2><p>An overview of 12-factor applications, and how a 12-factor application can be built using <span class=caps>WAS</span> Liberty and Bluemix.</p><p><a href=https://developer.ibm.com/wasdev/blog/2015/08/12/building-portable-12-factor-microservices-with-was-liberty-and-bluemix/>Continue with post on <span class=caps>IBM</span> DeveloperWorks</a></p></article><article><h2>Crib notes: Docker on OSX</h2><p>Of course I'm messing with Docker (isn't everyone)? But as most people using OS X are discovering, there are some hiccups. Here are some notes for myself (and perhaps for others) about what is required to make docker work well on OS X:</p><ul><li><a href=http://viget.com/extend/how-to-use-docker-on-os-x-the-missing-guide>How to Use Docker on OS X: The Missing Guide</a><ul><li>Most helpful (and a simultaneous &#8216;duh' moment) was his reminder: boot2docker is the host image for docker on OS X, so when docker maps ports, it maps them to boot2docker, and not to OS X itself. So there are some extra things that need to be done to make that work. He has lots of useful suggestions.</li></ul></li></ul><ul><li>I also use AnyConnect, which introduces it's own fun, as it likes to rewrite the routing table for giggles. I am thankfully <a href=https://github.com/boot2docker/boot2docker/issues/392#issuecomment-61999567>not the only one with this problem</a>. So there were good things to be gleaned here, too.</li></ul></article><article><h2>Crib notes: ubuntu 14.04 badness</h2><p>Woopsie. Somehow, with some update, I managed to screw nvidia up properly, and then in fixing that, I broke symantec antivirus, too. Part of it was that the 14.04 ubuntu headers have moved up, but the kernel was still at an older version, which made dkms pissy, and .. well.</p><p>Here is the (probably wrong and redundant, but it worked) list of things I did to fix it:<ul><li>sudo apt-get remove nvidia*</li><li>sudo apt-get remove (our symantec modules, yours will be named differently)</li><li>sudo apt-get autoremove</li><li>sudo apt-get install linux-image-generic-lts-trusty<ul><li>This upgrades to the latest linux kernel + tools, which then matched headers I obtained from other updates. Happiness here.</li></ul></li><li>sudo apt-get install (symantec modules, again <span class=caps>YMMV</span> with what these are called)</li></ul></p><p>As it turns out, I didn't bother putting the nvidia drivers back on. The fallback to the intel card was good enough, and I didn't want to go breaking myself again by accident. As this isn't my primary workstation, I have no idea how I got into this mess. Sounds dumb, but I was updating with only half my attention on what I was doing, and then the world broke, and there was a login loop, which turned out to be:<br>Xlib: extension &#8220;<span class=caps>GLX</span>&#8221; missing on display &#8220;:0&#8221;.<br>So. Yea.. busted nvidia drivers. We'll see how we do without. ;)</p><ul><li><a href=http://askubuntu.com/questions/451221/ubuntu-14-04-install-nvidia-driver>Q&A with scads of options</a></li></ul></article><article><h2>Updating to Yosemite: clean install with a clever backup</h2><p>I upgraded my iMac (which is aging, sadly) to Yosemite while taking a break from work.</p><p>I wanted to do a clean install: the drive had two partitions, one an old windows partition that we don't use anymore, and the other was full of crap from years of trying out apps and the migration from Snow Leopard to Lion to Mountain Lion to Mavericks, etc.</p><p>I wanted to make a full backup, so I could recover all of my settings and go scrounge around for files that I missed, etc., but I didn't want to clone a drive. I stumbled on these:</p><ul><li><a href=http://www.theinstructional.com/guides/disk-management-from-the-command-line-part-3>Disk Management from the Command-Line,</a></li><li><a href=http://osxdaily.com/2012/05/23/create-disk-image-of-mac-hard-drive/>How to create a disk image of an entire mac hard drive</a></li></ul><p>Can you see my plan? It worked very well.</p><p>I did have to boot into recovery mode (I had a bootable <span class=caps>USB</span> drive with the Yosemite installer on it, so I just used that), and I did use the command line instead of working through disk utility, though I believe either would have worked.</p><pre>&gt; hdiutil create /Volumes/External-USB/full-backup.dmg -srcdevice /dev/disk0s2</pre><p>I did have trouble with the windows partition, but we haven't used it in so long that I just made an image of the Documents & Settings folder, and called it a night.</p><p>After wiping the drive and putting Yosemite on, I was able to raid the *.dmg for apps and settings, etc. (I am sure I could have used the data migration utility, but I was trying to ditch the cruft&#8230; so I was selective. I have the dmg to refer to if I find something missing).</p><p>Whee!</p></article><article><h2>Bootstrapping ubuntu server on an external drive</h2><p>I have a new 2TB drive that I am going to use to replace a drive on a much used server that is currently running gentoo (which I have increasingly less time to tend). So. I have this new drive in an external enclosure, and I want to bootstrap it with the new OS without having to do that &#8220;go reboot your computer with a <span class=caps>USB</span> key thing&#8221;. I want my OS on the disk, I want to test that all the services can be coerced to behave the way I need them to behave, and I want to do all this with a minimum of fuss and gymnastics.</p><p>This whole setup is now sitting next to me crunching away, and as it is a combination of my experience bootstrapping gentoo in a chroot, and some of the (off the beaten path) instructions for creating debian chroots, I thought I'd throw them together in one place in case they help someone else out.</p><p>So, to get this working (my target is ubuntu trusty (server), and I'm working from ubuntu precise (desktop), you can swap as appropriate):<ol><li>I am fundamentally lazy, and hate having to type sudo all the time.<br><code>sudo /bin/bash</code></li><li>Get your drive configured.<br>In this case, I'm only going to use a small chunk of the 2TB for the OS so I can get things prepped, and then do some insane moving around of data once I have things going. Use your favorite tool for this, there are lots.</li><li>Mount your target partition where you want it, let's say /mnt/trusty</li><li>Make sure you have <a href=https://wiki.ubuntu.com/DebootstrapChroot>debootstrap</a><br>The instructions on the page are good, for me:<br><code>apt-get install debootstrap</code><ul><li>I did not bother with schroot, because that setup isn't what I'm after. debootstrap is enough.</li></ul></li><li>Use debootstrap to bootstrap your new OS on the mounted partition. This is roughly akin to gentoo's stage3 tarball extract:<br><code>debootstrap trusty /mnt/trusty http://archive.ubuntu.com/ubuntu/</code><br>And off it goes setting up the fundamentals of a new/fresh OS installation on your new shiny partition. Fun!</li><li>As it says on the debootstrap page above, there are a few more things you need to do to make this a usable chroot you can then use to set up your new system (install services, test configuration, blahblah)</li><ul><li><code>cp -L /etc/resolve.conf /mnt/trusty/etc/</code> — copy the resolv.conf file which contains the <span class=caps>DNS</span> information we need</li><li>Mount certain filesystems so things function properly, namely:<ul><li><code>mount -t proc proc /mnt/trusty/proc</code></li><li><code>mount -t sysfs sys /mnt/trusty/sys</code></li><li><code>mount --bind /dev /mnt/trusty/dev</code></li><li><code>mount --bind /dev/pts /mnt/trusty/dev/pts</code></li></ul></li><li>Chroot into the new file system, so you can then do some stuff.<br><code>chroot /mnt/trusty /bin/bash</code></li><li>Start setting up your new OS! Good recommendations:<br><code>apt-get update</code><ul><li>If you get messages about unknown keys, use the following to rectify, and then run update again:<br><code>apt-key adv --keyserver keyserver.ubuntu.com --recv-keys &lt;the number from the message></code></li></ul></li></ul></ol></p><p>Cheers!</p><p>p.s. You might also be able to do this from the distribution .iso, a la<br><code>debootstrap --arch i386 feisty /mnt/target file:/mnt/iso</code><br>I didn't try it, so <span class=caps>YMMV</span><ul><li><a href=http://wiki.soekris.info/Installing_Ubuntu_7.04_Server_via_debootstrap>Installing Ubuntu 7.04 Server via debootstrap</a></li></ul></p><p>p.p.s. also:<ul><li><a href=http://jonnytyers.wordpress.com/2013/01/26/debootstrap-installing-ubuntu-from-ubuntu/>http://jonnytyers.wordpress.com/2013/01/26/debootstrap-installing-ubuntu-from-ubuntu/</a></li><li><a href=https://help.ubuntu.com/community/Installation/FromLinux#Without_CD>https://help.ubuntu.com/community/Installation/FromLinux#Without_CD</a></li></ul></p></article><article><h2>DIY paper planner - with a cover</h2><p>So. It took one day, and I had to make a cover. I couldn't help myself. Thankfully, I have more scrapbooking supplies lying around than I know what to do with, so it didn't take too long.</p><p>I wanted pockets. I wanted pseudo-lamination. I wanted something that could still flex backwards. No problem, right?</p><p>I used three 12&#215;12 sheets of scrapbooking paper:<ul><li>one was thinner and more decorative, it forms the outer cover/pockets, and is completely backed with clear contact paper.</li><li>the other two are thicker, card stock weight. They form the inner sleeves that hold the planner and whatever else I might tuck in there.</li></ul></p><p>As I had no idea if it would work, and was kind of putting things together here and there in the house where I had room, I neglected to take work-in-progress photos. Don't hate me. I'll do what I can to describe what I did.</p><p><a href="{{site.baseurl}}{% link _posts/2013-09-23-diy-paper-planner.html %}">The planner</a>, remember, is basically an 8.5&#215;11&#8221; piece of paper folded in half, i.e. 5.5&#215;8.5&#8221;. What I wanted at the end of the day was an outer jacket, with some pockets, that would form a sleeve for the planner I stitched together.</p><p>So I started with how to make the sleeve for the planner. I used two matching pieces of 12&#215;12 paper, and folded each of them in half (6&#8221; wide). I trimmed each piece to 9&#8221; in height. I used a 2-3&#8221; wide piece of contact paper (centered) to cover the outside of each folded edge: these would be the outer edges of the cover. These two pieces lay side-by-side with the folded edges to the outside. I trimmed about 1/2&#8221; off the top layer for each piece to allow the planner to be added to the cover.</p><p><img src=/images/9t.jpg title="The inside of the cover" alt="The inside of the cover"></p><p>The outer/decorative cover is just one piece of 12&#215;12 paper with contact paper stuck to the outside of it. I measured/folded the paper first to make sure it would fit properly around the heavier card stock, trimmed some corners, and then cut the contact paper to be slightly bigger than the folded footprint of the paper. The contact paper was applied only to this outer cover. The contact paper is wrapped around all of the edges and trimmed corners.</p><p>Once the contact paper was on the outer cover, I used glue to attach the inner sleeves to the outer cover. The only glued area is shown in the picture above, where the outer cover is folded over to the inside of the sleeve. This, in effect, creates four pockets: two on the outside edge, between the outer cover and the sleeve, and two in the center, where the planner will tuck in.</p><p><img src=/images/8t.jpg title="Edge view -- pockets!" alt="Edge view -- pockets!"> <img src=/images/10t.jpg title="All together now!" alt="All together now!"></p><p>It works pretty well! It still lies flat, still bends open backwards, and looks very tidy closed.</p><p><img src=/images/7t.jpg title="cover made from 2 12x12 scrapbook pages" alt="cover made from 2 12x12 scrapbook pages"></p><p>Now to see if all this work makes it through the new-planner honeymoon period. I'll let you know in a few months..</p></article><article><h2>DIY paper planner</h2><img src=/images/4t.png class=right-box title="Cover view" alt="Cover view"><p>Those that have known me for a long time know that I am a sucker for planner. The trouble is that I don't use them much beyond the new planner honeymoon period (for any number of reasons).</p><p>With two kids and a change of house coming, I needed to do something for my overloaded brain, and no combination of apps on the phone is doing the job. Hubby and I do use Google calendars for a somewhat shared brain (at least with regard to who should be where and when), but I don't like Google tasks much (and can't unload work brain there, anyway). I also prefer hand-written lists and notes: I end up with little notes everywhere which doesn't help when you're already feeling overwhelmed!</p><p>So, I stumbled on <span class=caps>DIY</span> planner printables on Pinterest, and it got me thinking. None of the ones I saw were quite right, and I realized a few reasons why:</p><ul><li>they tend to be over-regimented</li><li>many split up or squish the weekend in the week view</li><li>many use a lot of color, which is nice, but I have a black and white laser printer, so all that flash is lost on me</li></ul><p>With all of that in mind, I made my own. It is sparse and unadorned, and has few boxes dedicated to this or that kind of note (to do, shopping list, contact list, etc.). This thing is basically all a to-do list of sorts, and I wanted to give myself room (with pen/pencil) to evolve how it works.</p><p>I used a booklet format: I printed off a set of double-sided pages, folded them in half along with a piece of card stock for the outer cover, and used a pamphlet stitch<sup id=fnrev18558719825240867d96bec class=footnote><a href=#fn18558719825240867d96bec>1</a></sup> to literally sew the pages together. It lies flat, I can fold it backwards, whatever! I love the form factor! I made only one month's worth, which also keeps it thin. I can make tweaks for next month based on how this month goes.</p><p>I've attached the keynote file<sup id=fnrev18914270245240867d9714e class=footnote><a href=#fn18914270245240867d9714e>2</a></sup> of this first draft. If you have Keynote, you can use this as a starting point for your own. I know the plain-ness of the cover won't last beyond the first few conference calls at work: the outside screams for doodles! The inside provides more room for jotted notes that I can then carry over into next month's booklet.</p><p><img src=/images/5.png title="Month overview" alt="Month overview"></p><p><img src=/images/6.png title="Week overview" alt="Week overview"></p><p>You can so tell that I am a software engineer, and not one used to posting photos of crafty things. *sigh*</p><h2>Resources</h2><p id=fn18558719825240867d96bec class=footnote><sup>1</sup> <a href=http://www.designsponge.com/2013/03/bookbinding-101-five-hole-pamphlet-stitch.html>Bookbinding 101: Five-hole Pamphlet Stitch</a></p><p id=fn18914270245240867d9714e class=footnote><sup>2</sup> <a href=/file_download/3/Planner-1.key title="First version of DIY monthly/weekly planner.">Planner-1.key</a></p></article><article><h2>lubuntu 11.04 on a thinkpad w520</h2><p>Getting ready to do some travelling for work (Hooray for people that <a href=http://wasdev.net>love our alpha</a>!), and figured I should move things from my much beloved purple Dell (which is the quadcore I got when I needed one), to the Lenovo Thinkpad W520 that is my official business issued laptop.</p><p>My dell is running straight-up ubuntu, with gnome modified to start fluxbox as its window manager (You have to understand that I *love* fluxbox-- you have to twiddle to get the themes so you like it, but if you're <a href=http://fluxbox.org/features/>addicted to tabs</a>, as I am, you're done). But.. that was kind of the "install everything and gradually remove what you don't want" approach. So, with the new shiny, I've opted for something in between the bare metal I started with when I was running gentoo, and the fully loaded ubuntu: <a href=https://help.ubuntu.com/community/Lubuntu>lubuntu</a>.</p><p>Lubuntu is small, stil ubuntu based (and I do like ubuntu-- gentoo was fun, but I have a toddler now.. and not nearly as much time left for figuring out why my system/tools don't work), and quite honestly, the devs did a great job of smoothing the experience of using something isn't gnome- or kde-centered.</p><p>The first thing I did was swap openbox with fluxbox (painlessly!). I'm now focused more on getting my data transferred to the new box. I'll post more as I start fussing with settings.</p><p>Good things to note:<ul><li>Stuff just worked. No huge show stop issues (and this with a W520). Granted, I didn't ask for trouble: I'm using the 32bit version of lubuntu natty--this thinkpad model is newer than the LTS release.</li><li>I am (thankfully) not the first to <a href=http://www.thinkwiki.org/wiki/Installing_Ubuntu_11.04_on_a_ThinkPad_W520>get ubuntu working on this model of thinkpad</a>.</li></ul></p></article><article><h2>ubuntu 10.10: sound crackling (especially pidgin), and fluxbox crashes</h2><p>I think I should have stayed w/ 10.04.</p><p>The audio was cracking: <a href=http://open-help.blogspot.com/2010/10/how-to-fix-crackling-sound-problem-in.html>known issue with a fix</a>. After applying that, pidgin alert sounds were still crackling. I had to go into pidgin prefs and change the method from Automatic to ALSA.</p><p>The real bugger is that fluxbox keeps crashing. I have gnome running (session manager, session prefs, etc.), but am using fluxbox as a window manager. I'm sorry.. all the compiz stuff looks cool, but once you start stacking/grouping windows, it's really hard to get used to a window manager that won't do it. I had fluxbox working as the window manager with Lucid (10.04) without issue, but for some reason, flux crashes a _lot_ with 10.10. Pain. (it's thankfully easy to restart flux without having to log out/in.. but still).</p></article><article><h2>DNS-323: FFP on a stick, nightly rsync backup...</h2><p>I have a lot of things working well, gathered from a lot of resources. I tweaked some scripts to make them work better:</p><ul><li>I created an /ffp/<hostname> directory for my personal scripts.</li><li>I have an rsync script that mirrors the ffp installation on the USB stick (/mnt/usb/ffp) to the primary hard drive (/mnt/HD_a2). This means I only have to maintain the USB-copy, but if the USB is not available, I'll still have working stuff on the regular drive.</li><li>I have a few (small) scripts that I use for cron jobs, rather than putting it all directly into the cron task: has the advantage of being able to use logger to add syslog messages.</li></ul><p>Very very simple: ffp-sync.sh for keeping the usb ffp in sync with the copy on the hard drive. I have this as a small, separate, invokable script so that I can run the backup myself if I've made changes and am feeling paranoid/proactive.</p><div class=code>#!/ffp/bin/sh
rsync -av --exclude=packages \
--exclude=var/log \
--exclude=var/run \
--delete /mnt/usb/ffp/ /mnt/HD_a2/ffp</div><p>This is the rsync line for the nightly backup from HD_a2 to HD_b2, based on scripts from the forum post(s) and the interwebs (see references below). The only real change here: using logger to get some evidence in the syslog about when backups start/stop.</p><div class=code>#!/ffp/bin/sh
export PATH=/ffp/sbin:/ffp/bin:$PATH
mv /ffp/var/log/rsync.last.log /ffp/var/log/rsync.last.log.prev
srcpath=/mnt/HD_a2/
dstpath=/mnt/HD_b2/backup
date=`date "+%Y%m%d"`
mkdir $dstpath/$date
logger Begin backup: $date
# Use rsync to backup content from the $srcpath to $dstpath/$date
# The contents of --link-dest=$dstpath/current are used as a 'base':
# files are hard-linked from that directory unless they've been changed,
# in which case the file is copied $srcpath.
# -ii is used to include detail in the log (which files are linked, which are copied)
/ffp/bin/rsync -avx -ii \
--exclude=ffp/var/log \
--exclude=ffp/var/run \
--exclude=lost+found \
--link-dest=$dstpath/current $srcpath $dstpath/$date \
> /ffp/var/log/rsync.last.log 2>&1

var=`ls -1A $dstpath/$date | wc -l`
echo $var
if [ $var -ne 0 ]
then
rm $dstpath/current
ln -s $date $dstpath/current
fi
logger Backup complete: $date</div><p>I also made a script (w/ syslog message: I like to be able to look back when things go wrong and know if/when cron jobs were running):</p><div class=code>#!/ffp/bin/sh
logger Checking time via sntp
/usr/sbin/sntp -r -P no us.pool.ntp.org</div><p>All of this is set up with /ffp/etc/fun_plug.local (of course). Having the home directories on the USB stick avoids the issues I was having before with the permissions being reset. I've preserved the authorized scripts, though, and ensure that they're run if/when the usb stick is unavailable at boot.</p><div class=code>#!/ffp/bin/sh
PATH=/ffp/sbin:/ffp/bin:/usr/sbin:/sbin:/usr/bin:/bin
# Use ffp busybox instead
mv /bin/busybox /bin/busybox-dns323
ln -s /ffp/bin/busybox /bin/busybox
if [ ! -h /data ]; then
ln -s /mnt/HD_a2 /data
fi
# if we're running from USB, then make sure home is mounted
if [ -d /mnt/usb/home/root ]; then
chmod -x /ffp/start/authorize*.sh 2>/dev/null
grep /home /proc/mounts >/dev/null 2>/dev/null
if [ $? -ne 0 ]; then
mount --bind /mnt/usb/home /home
fi
else
# If we aren't running from USB, make sure authorize* scripts are executable
chmod -x /ffp/start/authorize*.sh 2>/dev/null
fi
# update home directories in /etc/passwd (DNS-323 likes to reset them..)
usermod -d /home/xx -g 510 xx
# set timezone
echo 'EST5EDT,M3.2.0,M11.1.0' > /etc/TZ
# change cron jobs
echo "** Update cron jobs"
# This removes firmware cronjobs that interfere with ntpd.
crontab -l | grep -vw '/usr/sbin/daylight' | grep -vw '/usr/sbin/rtc' | grep -vw '/usr/sbin/stime' | crontab -
#Now start custom cron jobs, including the first which checks the date.
echo "0 * * * * /ffp/hostname/checkdate.sh" >> /var/spool/cron/crontabs/root
echo "1 * * * * /ffp/hostname/routerset.pl" >> /var/spool/cron/crontabs/root
echo "2 3 * * * /ffp/hostname/ffp-sync.sh" >> /var/spool/cron/crontabs/root
echo "5 3 * * * /ffp/hostname/backup.sh" >> /var/spool/cron/crontabs/root
cat /var/spool/cron/crontabs/root
# force a cronjob update
echo "root" >> /var/spool/cron/crontabs/cron.update</div><p>References:<ul><li><a href=http://forum.dsmg600.info/t2125-DNS-323-Rsync-Time-Machine!.html>Rsync Time Machine (DNS-323 forum)</a> -- source of backup script</li><li><a href=http://blog.interlinked.org/tutorials/rsync_time_machine.html>Time Machine for every Unix out there</a></li><li><a href="http://forum.dsmg600.info/viewtopic.php?id=1150">Tutorial: Backup Everything from Vol A to Vol B once a night</a></li></ul></p></article><article><h2>DNS-323: Finally back to it (SSH/busybox)</h2><p>After a long hiatus, I'm back to trying to finish customizing our NAS; life with kid means your extra time doesn't always get spent the way you'd like, and I've migrated to a new laptop running ubuntu en route, I should write about that, too.</p><p>Reviewed the <a href=http://wiki.dns323.info/howto:ffp#version_0.5>howto</a> again, to see where I left off, which was pretty much right where I finished writing the last entry.</p><h3>Setting up SSH</h3><p>Setting up SSH was fairly straight-forward. I did have to set up a script to copy the authorized_keys file for the root user to a directory in the flash memory (to ensure that I can log in with my ssh key across a reboot). I opted to create an authorize.sh script in /ffp/start, as described in <a href="http://forum.dsmg600.info/viewtopic.php?id=1630">this forum post</a>.</p><p>I also want to log in as a non-root user, and logging in with a public key (without a password) didn't seem to work unless the home directory for my user was also in flash memory (instead of on the mouted volume. So I created another script for "regular" users that I can use to set up more than one user: i.e. an account for me, one for the hubby (whenever he gets around to wanting one), etc. Here it is (/ffp/start/authorize-user.sh):</p><pre><code>#!/bin/sh

create_dir() {
    export USER_HOME="/mnt/HD_a2/users/$1"
    export NEW_HOME="/home/$1"
    export NEW_CHOWN="$1:$2"

    echo "USER = $1:$2, HOME = $USER_HOME, NEW = $NEW_HOME"
    if [ -d $USER_HOME ]; then
        if [ ! -d "$NEW_HOME" ]; then
            mkdir $NEW_HOME
            chown $1:$2 $NEW_HOME
            echo "directory created: `ls -ald $NEW_HOME`"
        fi

        if [ -x "$USER_HOME/.setup_home" ]; then
            echo "* /mnt/HD_a2/users/$1/.setup_home ..."
            /mnt/HD_a2/users/$1/.setup_home
        elif [ -d "$USER_HOME/.ssh" ]; then
            cp -Rpv $USER_HOME/.ssh $NEW_HOME
        fi
    fi
}

# One line per user to copy:
create_dir  "myuser"  "defaultGroup"

echo "done."
</code></pre><p>And that's it. Works fairly well: at the minimum, it copies the .ssh directory, which is required for ssh key-based login. For me, since I have to be fancy about things, I can put a .setup_home file (executable) in the home directory on the shared volume to give more direction about what should be copied and how. It "appears to function", but I haven't had the <a href="http://forum.dsmg600.info/viewtopic.php?id=135">permissions reset after a reboot</a> (yet). So we'll see if that still happens. I have a USB thumbdrive I intend to move ffp to, if I have issues with permissions problems, I may just move the home directories there so I can skip these copy steps altogether.</p><h3>Replacing busybox</h3><p>The howto mentioned updating the root busybox. I set the default path to put /ffp/bin first, but I also updated the link to busybox in the root /bin file in /ffp/etc/fun_plug.local:<pre><code>#!/ffp/bin/sh
PATH=/ffp/sbin:/ffp/bin:/usr/sbin:/sbin:/usr/bin:/bin

# Use ffp busybox instead
mv /bin/busybox /bin/busybox-dns323
ln -s /ffp/bin/busybox /bin/busybox
</code></pre><p>lighttpd and php next...</p><p><i>UPDATE - 6 Jun 2010: Holy hell, batman: when I originally wrote this, I totally typed SSL instead of SSH. WTF?!</i></p></article><article><h2>DNS-323: Initial set-up</h2><p>I purchased (a shamefully long time ago, welcome to tech live as a mom with a toddler) a DNS-323 (and two 1T drives) with the hope of moving most of our shared files onto it. Now that we don't record TV shows anymore, having that box on all the time is just a power drain. So: the goal is a DNS-323 with all of our files (photos, music, finance stuff, some movies, etc.) onto the first volume of that drive, and then using an rsync shadow with hardlinks to do nightly backups to the second drive. Some RAID configurations have been reported as less than stable, and using a mirror configuration requires both drives to be active: a nightly rsync backup will do.</p><h3>Applying firmware and extra software</h3><p>A <a href="http://www.dlink.com/products/default.aspx?pid=DNS-323&tab=3">firmware update</a> became available between when I bought the unit and when I finally got a chance to work on it-- so I updated the firmware to 1.08, and installed the optional NFS package, though I haven't set NFS up yet.</p><blockquote>Firmware<ol><li>Download the firmware update (as a zip) from dlink.com (under "Support Resources")</li><li>Unzip the download</li><li>Using the Web UI, go to the Tools tab, select Firmware from the left-hand menu</li><li>Use the browse button to find the firmware update (dns323_firmware_108 in my case)</li><li>Use the apply button (which is in the text above the form, oddly enough) to apply the firmware update</li></ol>Additional Software / NFS update<ol><li>Download the additional software package from dlink.com (under "Additional Downloads")</li><li>Unzip the download</li><li>Using the Web UI, go to the Advanced tab, and select "ADD-ONS"</li><li>Browse to the unzipped file using the appropriate form (Application Pack, in my case, with the file dns323_NFS _Package_v1.00)</li><li>Use the apply button to install the software: it will show up in the table below (in the case of the application pack, anyway), and you can toggle the status there (enable/disable via start/stop).</li></ol></blockquote><h3>Setting up funplug, etc.</h3><p>First, install <a href=http://www.inreto.de/dns323/fun-plug/0.5/>fun_plug (v0.5)</a>.<ul><li>I used the Web UI to create a new user, and then used the FTP to transfer fun_plug and fun_plug.tgz to Volume 1 as described <a href=http://wiki.dns323.info/howto:fun_plug>here</a>.</li><li>Easy to follow instructions to install additional packages from in the <a href=http://www.inreto.de/dns323/fun-plug/0.5/README.txt>README</a>:<blockquote><pre>telnet &lt;your-dns-323&gt;
cd /mnt/HD_a2
rsync -av inreto.de::dns323/fun-plug/0.5/packages .
cd packages
funpkg -i *.tgz
</pre></blockquote>That does install all of the additional packages, but <a href=http://wiki.dns323.info/howto:ffp#version_0.5>fonz's how-to</a> recommends,<blockquote><p>There's nothing in the install tarball (fun_plug.tgz) that's not in a package. The simplest way to stay current is to install all the main packages ( http://www.inreto.de/dns323/fun-plug/0.5/packages/ ).</p><p>I suggest to keep a local copy of the packages using rsync (don't forget –delete). Then use 'funpkg -i *.tgz' and 'funpkg -u *.tgz' to install and upgrade.</p></blockquote>So, that's what I did. At the end of the day, I'll be using quite a few of the extra packages anyhow...</li></ul>All of the above was easy enough, and gave me a telnet shell with root access (no password).</p><h4>Fixing the root user</h4><p><a href=http://wiki.dns323.info/howto:ffp#version_0.5>fonz's how-to</a> includes a section on "fixing" the root user.<table><tr><td>pwconv</td><td>Ensures we have an /etc/shadow file based on the contents of /etc/passwd</td></tr><tr><td>passwd</td><td>Set a password for root</td></tr><tr><td>usermod -s /ffp/bin/sh root</td><td>Set the root user's shell to one that won't prompt for an obscure unlock code</td></tr><tr><td>pwck</td><td>Sanity check the /etc/passwd file; ignore missing home directories for nobody and admin</td></tr><tr><td>grpck</td><td>Sanity check the /etc/group file; ignore bad group names 500/501</td></tr><tr><td>login</td><td>Test your changes: verify you can log in with the password you think you set. ;)</td></tr></table></article><article><h2>Movies schmovies</h2><p>Want to get DVDs playing on the laptop that is running gentoo that I'll only have to use for a few more days before I get a new shiny (purple!) one. I know, makes no sense.. but hey, learning is good, right?</p><ul><li>Use xine-ui. It got the farthest first.</li><li>Make sure your <a href=http://linvdr.org/projects/regionset/>region is set</a></li><li>Go through the few hoops you need to get raw i/o working. I pegged/tanked RAM w/o raw access -- every player segfaulted as a result (mplayer, xine, vlc). Use the raw device.</li><li>If it's an encrypted DVD (and you have libdvdcss installed), I found that I needed to change something in my environment to get it to correctly decrypt the disk: <code>export DVDCSS_METHOD=disc</code> -- I did it on the command line since I was just testing. Setting this finally let the DVD play.. with dropped frames all over the place.. but still.. progress!</li><li>And last, but not least, the simplest instruction from <a href=http://www.xine-project.org/faq#discardedskipped>xine's help</a>: change the niceness level of xine.. <code>nice --5 xine</code></li></ul><p>And poof! movie! with menu! rock on</p></article><article><h2>Amen for schedtool</h2><p>How did I not know about this sooner?</p><p>Trying to build a particularly large maven project would consume so much CPU that my poor laptop would quit because it was sweating too much.</p><p>I used schedtool to set an affinity to only one of the two CPUs available on my dual-core laptop for the shell I used to launch the build, and voila! Things don't get as hot, and my system stays responsive. *phew!*</p><ul><li><a href=http://linux.die.net/man/8/schedtool>schedtool</a></li></ul></article><article><h2>Upgrading old rails apps...</h2><p>I have to say that updating RoR for old apps always lands me in some wonky funny business: missing config variables, moved whatsits and thingummies. grr. The issues aren't easy to search for, either.</p><p>This time:</p><ul><li>Bad routing with Apache Alias: that started acting up, too. I have an app at "/app" (for example), and was mapping "/app/shortname" to one of the controllers. This worked before, post upgrade of rails, it would actually look for "/app/shortname", when only 'shortname' was in the rails routes.rb (which means the app in general didn't behave, as you clicked along, the missing prefix kept messing things up). The fix came from the item below.. upgrading passenger resolved it.</li><li>"Unknown method rewind"<br>Again, no effing clue why/where... just wanted to fix it so it would go away (I know, lazy, right?): Amen that <a href=http://hamishrickerby.com/2009/08/04/undefined-method-rewind-and-rails-2-3-3/>someone already figured this one out</a>... Passenger needed to be updated.</li><li>So, what's next? convention change... <%= render "layouts/whatever" %> now maps to apps/view/layouts/_whatever.erb instead of apps/view/layouts/whatever.rhtml. Renaming fun.</li></ul><p>Useful:</p><ul><li><a href=http://blog.zobie.com/2008/11/testing-routes-in-rails/>Testing Routes in RoR</a></li></ul></article><article><h2>Ejecting the CD when things are hosed...</h2><p>So, in starting to set up bootcamp, I totally managed to f something up! (Yes, I can even break a Mac). I tried the usual turn off / turn on the machine, and CRAP! the CD is still in the drive, and it HAS NO BUTTONS. Eject is totally software driven.</p><p>Thankfully, someone already <a href=http://www.associatedcontent.com/article/4363/ejecting_a_stuck_cd_in_mac_osx.html>took the time to list</a> all of the interesting things you should try to get your CD back. Number 3 did the trick.</p><blockquote><ol><li>The iTunes eject button</li><li>Disk Utility ...</li><li>Hold down mouse button at startup</li><li>Hold down C key at startup</li><li>Start up into Open Firmware ...</li><li>Start up in Target FireWire mode ...</li><li>Start up from another machine</li><li>Take your machine to an Apple Store</li></ol></blockquote></article><article><h2>Happy Solstice!</h2><p>The longest night of the year has come.. the shortest day of the year is done, and I... well.</p><p>So there was this box. It got shipped here a little while ago. It's large, squarish, and only about a foot and a half deep. It's been sitting in the dining room by the skimpily ornamented Norfolk pine and the tiny Meyer lemon tree (which is just beside itself with lemons on the make, but that's another story).</p><p>Chris was very careful that I not see anything about it (I also was honest and didn't go looking.. I mean, what's the fun of that?), but he has asked me to guess what it was.. "A spare tire", "A wall-hanging jewelry closet", "A mirror"... The closest I could come (and I didn't think I had a chance in hell of it being so) was a big beautiful LCD monitor to replace the monstrosity on my desk downstairs.</p><p>And Lo! it was a big beautiful LCD monitor.. complete with a bluetooth wireless keyboard and mouse. My husband, that wonderful man, gifted me an iMac.</p><p><i>Yesss..</i></p></article><article><h2>Well, as Jon was bugging me about it..</h2><p>I have, in fact, begun publishing my scans on <a href=http://silverpuddle.deviantart.com/>deviantArt</a>.. I told you I wanted to get prints of some of them.. ;)</p><p>The scanning has only just begun, though, so be patient. Some of these images have spent too long in a sketchbook rubbing against other pages.. so it's hard to get the scan so it doesn't look so darn grainy. *sigh*</p></article><article><h2>Fixing ATI again..</h2><p>I'm also rebuilding my T60p in place (meaning I started half of it while chrooted, and have now switched over to the newer half...).</p><p>I've run into a new issue loading the dri drivers: AIGLX error: dlopen of /usr/lib/dri/fglrx_dri.so failed (/usr/lib/dri/fglrx_dri.so: undefined symbol: __glXFindDRIScreen). Moving to the latest ati driver seemed to fix that (8.37.6-r1).</p><ul><li><a href=http://xoomer.alice.it/flavio.stanchina/debian/fglrx-installer.html#configure>ATI Linux drivers for debian</a> has great information around how to configure X11 to work with the proprietary ati drivers.</li><li><a href=http://www.thinkwiki.org/wiki/Fglrx>Fglrx - ThinkWiki</a> is a good source for how this stuff all works with thinkpads...</li></ul></article><article><h2>Scanning in my pencil sketches...</h2><p>So, I blew some time this weekend working on getting some of my pencil sketches scanned in the right way (why I decide the summer is the time to try this stuff.. ). There are a few of them I've been lugging along in my silly sketchbook, and I really like them.. which actually makes me less likely to carry the thing along, because it could mess up some of those doodles I really like.</p><p>So. I started by *gasp* removing them all from my little sketch book. I happen (because I'm a dork) to be equipped with things to make a nice portfolio with these sketches in them because of other crafty things, so I know where they'll end up. BUT.. before they go there, I'd like to get some high-quality scans of them (I'd like to be able to make prints of at least one..).</p><p>Anyway, after wasting scads of time, I can agree that the following links have whatchya need:<ul><li><a href="http://www.wesnoth.org/forum/viewtopic.php?p=237028&sid=9841f0d9a9a1446da796982b57d54420">Scanning pencil drawings</a> (question in forum thread)</li><li><a href=http://www.wesnoth.org/wiki/Extending_dynamic_range>Extending dynamic range</a> (resulting HOW-TO)</li></ul></p><p>I've been going back and forth between the two plugins mentioned in the posts above, and I'm also hovering between the two methods (two gimp plugins: <a href=http://www.trsqr.net/photokit/dre.html>dynamic range extender</a> (DRE) or <a href="http://registry.gimp.org/plugin?id=9520">HDR tone mapping</a>). As I go, I have been slowly leaning towards the first (which is what the author used for the example in the HOW-TO), mostly because I can then scan and work with the image all in grayscale (the HDR plugin assumes RGB mode). Not sure which is better in the end, but I'm finding the output from the DRE plugin to be more direct.</p><p>Scan w/ XSane:<ul><li>Standard options window: Brightness (1, 0, -2 or -3), Sharpness 1</li><li>Created a "pencil sketch" medium: Gray with 1.0 Gamma, and -100/100 brightness/contrast (basically telling the xsane post-scanning processor to leave it alone)</li></ul></p></article><article><h2>Emergency brain</h2><p>Thank goodness I have a functioning emergency brain. I've never needed to know that I even had one, much less whether or not it worked, until the unfortunate events of the past few weeks unfolded.</p><p>My Dad was in a very unfortunate accident at work. Rather than bandy on about it here, I'll send you to <a href=http://mike.haaser.com>the site we've created to share the news</a> (my Dad has a rather large fan club.;) ).</p><p><a href=http://mike.haaser.com>http://mike.haaser.com</a></p></article><article><h2>When and where to use images..</h2><p>I just read/skimmed <a href=http://24ways.org/2005/naughty-or-nice-css-background-images>Naughty or Nice? CSS Background Images</a> <span class=attribute>[<a href=http://24ways.org/>http://24ways.org/</a>]</span>. Now this is an old post (2005), and I don't remember how I stumbled on it, but the post makes a good point - don't stick in CSS what should be delivered via content.</p><p>I always try (with mixed success, I admit - it depends on how much control I have) to load my pages in lynx or some other text based browser to make sure I can still get around. I increasingly find sites that are not navigable sans full-graphical-browser tricks.</p></article><article><h2>DNS Monster</h2><p>So. For a few reasons, I have been moving my websites and domains off to <a href=http://www.hostmonster.com/hosting-features.htm>hostmonster</a>: a) free transfer + renewal; b) registerfly has been <a href=http://warning-about-registerfly.com/>sucking</a>, and some of my domains got caught in the <a href=http://registerflies.com/enom-help-with-registerfly-problems.html>registerfly/enom.com fiasco</a>, and I really just want to get them the hell out, c) hostmonster has ssh, php, mysql, ruby on rails - pretty much anything I ever wanted to tinker with, d) I can stick however many domains on my account that I want to.</p><p>The downside: CPanel, and DNS manipulation. I am used to having my hands right on the DNS records - with CPanel, not only can I not touch the records, but in certain cases, they have rules (either self imposed or imposed by CPanel's Web Host Manager thing) that just plain prevent me from doing what I want. I hate not being able to do what I want. (whine whine whine).</p><p>But look what I found: <a href=http://editdns.net/>EditDNS.net</a> - A DNS provider of free web hosting and a bunch of other goodies. They thrive on donations of course, but still... worth a try, I think.</p></article><article><h2>Gentoo and an IBM T60p - Part 2: Dual Boot / NTFS</h2><p>I have what I tried below, but I eventually dropped the attempt. The Lenovo modules hung up <span class=caps>VMW</span>are any time I tried to boot it that way, and while I could mount the <span class=caps>NTFS</span> partition used by WinXP R/W with the tools below, I could not easily get WinXP to look at the lion's share of the drive. (My fault, really – if I weren't so attached to other filesystem types, I could probably have made this work).</p><h3>Dual Boot</h3><p>My new-fangled laptop comes with XP Pro, and I don't have disks for re-installing that OS from scratch (in <span class=caps>VMW</span>are, for example). So, as an experiment, I decided to resize the WinXP partition, and put gentoo on the lion's share of the drive. I want to see if I can get a dual-boot OR <span class=caps>VMW</span>are image running off of that same base – because I think that would be cool<sup id=fnrev7048958234fd685f22dbf8 class=footnote><a href=#fn7048958234fd685f22dbf8>1</a></sup>. File access would be interesting – but that's another story; I want to see if it will work, first. As part of that effort, I also added support for R/W <span class=caps>NTFS</span><sup id=fnrev422670574fd685f22dc27 class=footnote><a href=#fn422670574fd685f22dc27>2</a></sup>.</p><ul><li>sys-fs/ntfsprogs-1.13.1</li></ul><p>While poking around, I read up on <span class=caps>NTFS</span><sup id=fnrev21372720164fd685f22e6a2 class=footnote><a href=#fn21372720164fd685f22e6a2>3</a></sup> – and I think, based on the interoperability section, that I'll also look into ntfs-3g. Note that this requires the freshest version of fuse, which means: don't compile <span class=caps>CONFIG</span>_FUSE_FS into your kernel. Either compile it as a module, or leave it out entirely.</p><ul><li>sys-fs/fuse-2.6.0</li><li>sys-fs/ntfs3g-0.20061115-r1</li></ul><h3>Footnotes / References :</h3><p id=fn7048958234fd685f22dbf8 class=footnote><sup>1</sup> <a href=http://www.geocities.com/epark/linux/grub-w2k-HOWTO.html>Dual-boot with Grub</a> <span class=attribute>[<a href=http://www.geocities.com/epark/linux/>geocities.com/epark/linux/</a>]</span> , and <a href=http://news.u32.net/articles/2006/07/18/running-vmware-on-a-physical-partition>Running <span class=caps>VMW</span>are on a Physical Partition</a></p><p id=fn422670574fd685f22dc27 class=footnote><sup>2</sup> <a href=http://gentoo-wiki.com/HOWTO_NTFS_write_with_ntfsmount><span class=caps>HOWTO</span> <span class=caps>NTFS</span> write with ntfsmount</a> <span class=attribute>[<a href=http://gentoo-wiki.com/>gentoo-wiki.com</a>]</span></p><p id=fn21372720164fd685f22e6a2 class=footnote><sup>3</sup> <a href=http://en.wikipedia.org/wiki/NTFS><span class=caps>NTFS</span></a> :wiki:</p></article><article><h2>Gentoo and an IBM T60p - Part 3: Networking</h2><p>Getting networking up and running on the T60p has been a mixed bag. On one hand, the wired connection was easy (expected). The wireless was at first <span class=caps>REALLY</span> flaky, then after some fiddling the connection at home (<span class=caps>WEP</span>) was functional, and as of now (when I'm finally posting this thing) it still doesn't work at work (<span class=caps>LEAP</span>).</p><h3>Wired connection</h3><p>I set the wired connection (using e1000 module) up with netplug so that it will figure out when the cable is and isn't there – it has the added bonus of scheduling net-dependent services at startup.</p><ul><li>sys-apps/netplug-1.2.9-r3</li></ul><h3>Wireless</h3><p>For whatever reason, this laptop does not have an Intel wireless chipset. The Atheros AR5212<sup id=fnrev11129864324fd685eb57840 class=footnote><a href=#fn11129864324fd685eb57840>1</a></sup> that it does have requires the <code>madwifi</code> driver.</p><p>I also need <span class=caps>WEP</span> and <span class=caps>LEAP</span>, so I use wpa_supplicant as well.</p><ul><li>net-wireless/wireless-tools-28</li><li>net-wireless/ieee80211-1.1.13-r1</li><li>net-wireless/madwifi-ng-0.9.2.1</li><li>net-wireless/madwifi-ng-tools-0.9.2</li><li>net-wireless/wpa_supplicant-0.5.4</li></ul><p>At first, wpa_supplicant would drop the connection after a few minutes. I couldn't find anything conclusive about why this was happening, but the one thing I did find suggested using the generic interface (wext) with wpa_supplicant rather than madwifi<sup id=fnrev8827124634fd685eb57f89 class=footnote><a href=#fn8827124634fd685eb57f89>2</a></sup>. No change.</p><p>When at home using <span class=caps>WPA</span>, the connection cycled frequently (sometimes as frequently as once every 4 or 5 minutes). When at work trying to use <span class=caps>LEAP</span>, it wouldn't correctly establish a connection at all. :sigh:</p><p>I think I was suffering from a known bug<sup id=fnrev18397749934fd685eb583ab class=footnote><a href=#fn18397749934fd685eb583ab>3</a></sup>, so I created some new ebuilds for the 1605 version of madwifi-ng. That seems to have improved the resilience of the connection considerably.</p><p>I <strong>still</strong> am having trouble with rotating through connections and associating via <span class=caps>LEAP</span> at work. I have been using ap_scan=2 because of hidden <span class=caps>SSID</span>s in the office, the problem is that this forces profiles to be tried in order, and when wpa_cli fails on the first one, it seems not to automagically roll over to the next (which previous versions of wpa_supplicant did just fine.. )</p><p>I've found some evidence<sup id=fnrev13878314054fd685eb5893f class=footnote><a href=#fn13878314054fd685eb5893f>4</a></sup> suggesting that ap_scan=2 won't work because madwifi-ng doesn't support it. Lovely. But! There is hope<sup id=fnrev5177507454fd685eb58989 class=footnote><a href=#fn5177507454fd685eb58989>5</a></sup> a patch was added to the madwifi driver at a later level than the one I had to revert to.</p><p>I haven't retried wireless at work recently. I'll post more when I do.</p><p>— <em>update 2007 Jan 5: madwifi-ng-0.9.2.1 should also include the association fix&#8230; I am now using madwifi-ng-0.9.2.1 (r1842), and that seems to work as well.</em></p><h3>Footnotes / References :</h3><p id=fn11129864324fd685eb57840 class=footnote><sup>1</sup> <a href=http://www.gentoo-wiki.com/HARDWARE_ar5212><span class=caps>HARDWARE</span> (Atheros) ar5212</a> <span class=attribute>[<a href=http://gentoo-wiki.com/>gentoo-wiki.com</a>]</span></p><p id=fn8827124634fd685eb57f89 class=footnote><sup>2</sup> <a href=http://lists.shmoo.com/pipermail/hostap/2006-June/013430.html>wpa_supplicant + madwifi + hidden <span class=caps>SSID</span></a></p><p id=fn18397749934fd685eb583ab class=footnote><sup>3</sup> <a href=http://madwifi.org/ticket/973>ThinkPad Z60t: moving from r1543 to r1757 madwifi stops working at all</a></p><p id=fn13878314054fd685eb5893f class=footnote><sup>4</sup> <a href=http://lists.shmoo.com/pipermail/hostap/2005-March/009669.html>ap_scan=2 problem?</a></p><p id=fn5177507454fd685eb58989 class=footnote><sup>5</sup> <a href=http://madwifi.org/ticket/275>Scan for non-<span class=caps>ESSID</span>-broadcasting access point always fails</a></p><h3>Other References (of course):</h3><ul><li><a href=http://madwifi.org/wiki/UserDocs>MadWifi User Docs</a> <span class=attribute>[<a href=http://madwifi.org>madwifi.org</a>]</span></li><li><a href=http://www.thinkwiki.org/wiki/Installing_Ubuntu_6.06_Flight_6_on_a_ThinkPad_X60s>Ubunto on X60s</a> — ndiswrapper for Atheros</li></ul></article><article><h2>Rails: Staying away from Enums in Migrations</h2><p>I was fiddling with migrations, and found these regarding the use of MySQL-ish <span class=caps>ENUM</span>s in Migrations:</p><ul><li><a href=http://rails.techno-weenie.net/forums/1/topics/180>Enum fields in migrations?</a> <span class=attribute>[<a href=http://rails.techno-weenie.net/>rails.techno-weenie.net</a>]</span></li><li><a href=http://wiki.rubyonrails.com/rails/pages/HowtoUseSetAndEnumColumns>HowtoUseSetAndEnumColumns</a> <span class=attribute>[<a href=http://wiki.rubyonrails.com/>wiki.rubyonrails.com</a>]</span></li></ul><p>Basically, <span class=caps>ENUM</span>s aren't supported, and using Validations might be a good work-around, but is dependent on you putting (and keeping) all of the logic in your Rails app. If you need to go cross-app (with some other thing that ain't rails), then use <span class=caps>CHECK </span>or other DB constraints to enforce desired values.</p></article><article><h2>Gentoo and an IBM T60p - Part 1: Installation and X</h2><p>Got a new T60 <strong>yay!</strong>, here's my brain dump on getting it to work with gentoo (2006.1).</p><p>See also (Updated as new parts are added):</p><ul><li><a href=/config/261/GentooandanIBMT60pPart2>Part 2: <span class=caps>NTFS</span></a></li><li><a href=/config/260/GentooandanIBMT60pPart3>Part 3: Networking</a></li></ul><h3>General 'fo:</h3><table><tr><td>Motherboard:</td><td>Lenovo ThinkPad T60 2613EJU<sup id=fnrev21131636054fd685f89dc07 class=footnote><a href=#fn21131636054fd685f89dc07>1</a></sup></td></tr><tr><td>Processor:</td><td>Intel Core Duo T2600 (2.16GHz)<sup id=fnrev15003744444fd685f89de7a class=footnote><a href=#fn15003744444fd685f89de7a>2</a></sup></td></tr><tr><td>Memory:</td><td>2 &#215; 1G DDR2</td></tr><tr><td>Graphics Card:</td><td><span class=caps>ATI</span> Mobility FireGL 256MB</td></tr><tr><td>Hard Drives:</td><td>100GB <span class=caps>SATA</span> 7200RPM</td></tr><tr><td>Sound Card:</td><td>Intel (ICH7) : <span class=caps>ALSA</span> hda-intel<sup id=fnrev16564309884fd685f89e634 class=footnote><a href=#fn16564309884fd685f89e634>3</a></sup></td></tr><tr><td>Wired:</td><td>Intel Corp. 82573L Gigabit</td></tr><tr><td>Wireless:</td><td>Atheros Communications AR5212 <span class=caps>NIC</span></td></tr></table><h3>Installation</h3><p>I followed the general install instructions for gentoo; no rocket science here. I used 2006.1/desktop profile, which sets a lot of handy use flags for you – what you have to do is unset those you don't want (like gnome or kde). In general, I try to keep the global flags list short(er) – though the default desktop profile pulls a lot of stuff in. I prefer setting use flags per package via the /etc/portage/package.use file.</p><blockquote><p>added: acpi directfb dmx fbcon fuse gtk2 hdaps madwifi mmx motif opengl real samba smp sse sse2 svg syslog usb wifi</p></blockquote><blockquote><p>removed: -arts -apm -esd -gnome -ipv6 -kde -ldap -nls</p></blockquote><p><em>Note:</em> <code>euse</code> (from gentoolkit) is very useful here. Using <code>euse -i</code> you can tell: a) all of the packages that make use of a given flag and what they use it for, and b) whether or not it's included or excluded from the default profile or from your make.conf. Handy stuff.</p><p>I adjusted the grub install for Dual-boot, and did some checking for kernel options: a) <span class=caps>ACPI</span> configuration, b) removing <span class=caps>DRM</span> because of the <span class=caps>ATI</span> chipset (below), etc.</p><p>Just for the hell of it, I set up sSMTP to route to my gmail account<sup id=fnrev4313280124fd685f89fc9d class=footnote><a href=#fn4313280124fd685f89fc9d>4</a></sup>.</p><ul><li>sys-kernel/gentoo-sources-2.6.18-r3</li><li><a href=/files/config-2.6.18-gentoo-r3.txt>kernel .config</a></li></ul><h3>Pointing devices:</h3><p>I decided to add drivers for the touchpad (we'll see how long it lasts – I'll probably end up disabling it via the <span class=caps>BIOS</span>..) and for using the mouse on(in? at?) the console. I didn't need to do anything special aside from emerging the packages (and in the case of gpm, starting the daemon via /etc/init.d/gpm).</p><ul><li>x11-drivers/synaptics-0.14.5-r1</li><li>sys-libs/gpm-1.20.1-r5</li></ul><h3>On-Screen Display and Thinkpad things</h3><p>For thinkpad buttons, I use <code>tpb</code> with the <code>xosd</code> use flag to enable on-screen display when you push things (like the volume buttons). After emerging tpb, update <code>/etc/tpbrc</code> per your preferences. Use the <code>hdaps</code> useflag with <code>tm_smapi</code> to enable 1/2 of automatic HD head parking function (the reading-the-data part).</p><p>For on-screen display to work w/ X, you have to start tpb when you start X, and it has to have access to the display, etc.</p><ul><li>x11-libs/xosd-2.2.14-r1</li><li>app-laptop/tpb-0.6.4</li><li>app-laptop/tp_smapi-0.27</li><li>app-laptop/tpctl-4.17</li><li><a href=/files/tpb.sh>script for starting tpb</a></li></ul><h3>Setting up X</h3><p>This is the fun part. As noted above, the T60 uses an <span class=caps>ATI</span> FireGL graphics chipset, which means binary <span class=caps>ATI</span> drivers<sup id=fnrev19985520194fd685f8a126c class=footnote><a href=#fn19985520194fd685f8a126c>5</a></sup>. I grabbed the latest of both <code>ati-drivers</code> and <code>ati-drivers-extra</code> (with <code>~x86</code> for both in /etc/portage/package.keywords). The combination of use flags mentioned above were sufficient for both packages.</p><p><em>Note:</em> <code>ati-drivers-extra-8.30.3</code> required libXinerama when the qt use flag is enabled, even if qt did not use that flag. I had to emerge <code>x11-libs/libXinerama</code> for <code>ati-drivers-extra</code> to compile properly.</p><p>After emerging the package (followed by <code>source /etc/profile</code> to regen path strings), I copied the <code>xorg.conf.example</code> to <code>xorg.conf</code> (in <code>/etc/X11</code>) and used <code>aticonfig --initial --input=/etc/X11/xorg.conf</code> to create an initial xorg.conf file. Then I updated the file to strip down what was in there – keeping the <span class=caps>ATI</span> stuff, and punting the extra stuff.</p><p>Without too much fooling around, X came up (with <span class=caps>DRI</span> and everything). The settings generated by aticonfig left a lot to X11 defaults. 1600&#215;1200 at depth 24:<br><pre><code># xdpyinfo | grep resolution -A 1 -B 1
dimensions: 1600x1200 pixels (301x221 millimeters)
resolution: 135x138 dots per inch
depths (7): 24, 1, 4, 8, 15, 16, 32
</code></pre></p><p>Now, I did check out <code>sys-apps/ddcxinfo-knoppix</code>, and I have to say it's pretty neat. It spat out all kinds of things about the <span class=caps>TFT</span> display. I've included the output in the list below.</p><ul><li>x11-drivers/ati-drivers-8.30.3-r1</li><li>x11-apps/ati-drivers-extra-8.30.3</li><li>x11-base/xorg-x11-7.1</li><li><a href=/files/xorg.conf.t60p>xorg.conf</a></li><li><a href=/files/T60p.ddcxinfo>ddcxinfo-knoppix for T60p <span class=caps>TFT</span> display</a>, <a href=/files/T60p.ddcxinfo.monitor>ddcxinfo-knoppix monitor section</a></li></ul><p>I did see the following message in Xorg.0.log: <code>(EE) AIGLX error: dlopen of /usr/lib/dri/fglrx_dri.so failed (/usr/lib/dri/fglrx_dri.so: cannot open shared object file: No such file or directory)</code>. According to the <a href=http://www.gentoo.org/proj/en/desktop/x/x11/modular-x-howto.xml>Modular X Migration</a> guide:</p><blockquote><p>Note: With modular installed, external drivers such as nvidia-glx and wacom as well as some vnc apps may not work if they install things to <code>/usr/lib/modules</code> instead of <code>/usr/lib/xorg/modules</code>. Many of these will have modular X detection added to the installation process.</p></blockquote><p>The ati-drivers ebuild does have such detection, and the requested library was installed in the new location (<code>/usr/lib/xorg/modules/dri</code>) however, it looks like the code trying to load the <span class=caps>DLL</span> is still expecting it in the old place? I tried the most obvious first.. create a symlink from the new location to the old. That seemed to really open things up.</p><pre><code># glxinfo
direct rendering: Yes
server glx vendor string: SGI
server glx version string: 1.2
...
client glx vendor string: ATI
client glx version string: 1.3
...
OpenGL vendor string: ATI Technologies Inc.
OpenGL renderer string: ATI MOBILITY FireGL V5200 Pentium 4 (SSE2) (FireGL) (GNU_ICD)
OpenGL version string: 2.0.6119 (8.30.3)
</code></pre><p>I still, however, saw an error message: <code>AIGLX error: dlsym for __driCreateNewScreen_20050727 failed (/usr/lib/dri/fglrx_dri.so: undefined symbol: __driCreateNewScreen_20050727</code>. This seems not to harm anything, and the screen is so darn beautiful I just want to use it for awhile.</p><h3>Sound</h3><p>Why not. Sound next. In the kernal config, I enabled support for <span class=caps>ALSA</span> as modules. I enabled Intel HD Audio PCI Driver for the kernel-based hda-intel module. I didn't have to set up any of the dmix stuff I used to, as (I seem to remember reading) that's all built in these days. Everything "appears to function" right out of the box. Goodness!</p><ul><li>media-sound/alsa-utils-1.0.13</li><li>media-libs/alsa-oss-1.0.12</li></ul><h3>Footnotes / References :</h3><p id=fn21131636054fd685f89dc07 class=footnote><sup>1</sup> <a href="http://www-307.ibm.com/pc/support/site.wss/document.do?sitestyle=lenovo&lndocid=MIGR-62487">Overview – ThinkPad T60, T60p</a> <span class=attribute>[<a href=http://www.ibm.com>www.ibm.com</a>]</span></p><p id=fn15003744444fd685f89de7a class=footnote><sup>2</sup> <a href=http://support.intel.com/support/notebook/centrino/duo/>Intel&#174; Centrino&#8482; Duo Mobile Technology</a> <span class=attribute>[<a href=http://www.intel.com>intel.com</a>]</span><br><a href="http://processorfinder.intel.com/details.aspx?sSpec=SL8VN">Intel&#174; Core&#8482; Duo processor T2600</a></p><p id=fn16564309884fd685f89e634 class=footnote><sup>3</sup> <a href="http://www.alsa-project.org/alsa-doc/doc-php/template.php?company=Intel&card=ICH+southbridge+HD-audio+and+modem.&chip=ICH6%2C+ICH6M%2C+ICH7%2C+ESB2&module=hda-intel"><span class=caps>ALSA</span>: hda-intel</a> <span class=attribute>[<a href=http://www.alsa-project.org>alsa-project.org</a>]</span></p><p id=fn4313280124fd685f89fc9d class=footnote><sup>4</sup> <a href=http://gentoo-wiki.com/HOWTO_Gmail_and_sSMTP><span class=caps>HOWTO</span> Gmail and sSMTP</a> <span class=attribute>[<a href=http://gentoo-wiki.com/>gentoo-wiki.com</a>]</span></p><p id=fn19985520194fd685f8a126c class=footnote><sup>5</sup> <a href=http://odin.prohosting.com/wedge01/gentoo-radeon-faq.html#1_whyuse>Gentoo <span class=caps>ATI</span> Radeon <span class=caps>FAQ</span></a> <span class=attribute>[<a href=http://odin.prohosting.com/wedge01/>odin.prohosting.com/wedge01</a>]</span></p><p id=fn6 class=footnote><sup>6</sup> <a href=http://www.mozilla.org/unix/dpi.html>Mozilla Font Size / <span class=caps>DPI</span> Issues</a></p><h3>Other References (of course):</h3><ul><li><a href=http://tuxmobil.org/centrino.html>Linux on Intel&#174; Centrino&#8482; and Centrino-Duo&#8482; Laptops and Notebooks</a> <span class=attribute>[<a href=http://tuxmobil.org/>tuxmobil.org</a>]</span></li><li><a href=http://tuxmobil.org/ibm.html>Linux Laptop and Notebook Installation Survey: <span class=caps>IBM</span>/Lenovo</a> <span class=attribute>[<a href=http://tuxmobil.org/>tuxmobil.org</a>]</span></li></ul><ul><li><a href=http://www.hardwareinreview.com/cms/content/view/49>Lenovo ThinkPad T60p review</a> <span class=attribute>[<a href=http://www.hardwareinreview.com>hardwareinreview.com</a>]</span></li><li><a href=http://thinkwiki.org/wiki/Category:T60p>Category:T60p</a> <span class=attribute>[<a href=http://thinkwiki.org/>thinkwiki.org</a>]</span></li><li><a href="http://zachtib.com/?p=19">The new Thinkpad T60p</a> <span class=attribute>[<a href=http://zachtib.com>zachtib.com</a>]</span></li><li><a href=http://buzzy.tesuji.org/thinkpad_t60p.html>Gentoo Linux on the Thinkpad T60p</a></li><li><a href=http://www.thinkwiki.org/wiki/Installation_instructions_for_the_ThinkPad_T60p>Installation instructions for the ThinkPad T60p</a> <span class=attribute>[<a href=http://www.thinkwiki.org>thinkwiki.org</a>]</span></li><li><a href=http://www.thinkwiki.org/wiki/HDAPS><span class=caps>HDAPS</span></a> <span class=attribute>[<a href=http://www.thinkwiki.org>thinkwiki.org</a>]</span><ul><li><a href=http://www.thinkwiki.org/wiki/How_to_protect_the_harddisk_through_APS>How to protect the harddisk through <span class=caps>APS</span></a></li></ul></li><li><a href=http://gentoo-wiki.com/HOWTO_ALSA_sound_mixer_aka_dmix title="Complete, include sound mixer"><span class=caps>HOWTO</span> Alsa</a> <span class=attribute>[<a href=http://gentoo-wiki.com>gentoo-wiki.com</a>]</span></li><li><a href=http://www.infinitephoto.com/pages/dpi.htm><span class=caps>DPI</span> and File Size calculator/formulas</a> <span class=attribute>[<a href=http://www.infinitephoto.com>www.infinitephoto.com</a>]</span></li></ul><p><em>2007-01-05: Updated to make all linked files work (missed uploading a few), added link to Parts 2 and 3.</em></p></article><article><h2>Rails: Printing validation errors as flash notices</h2><p>I am quite sure someone has already found this simple solution, but when I poked around, I couldn't find it.</p><p>Here is my snippet to print out the error messages resulting from a validation as a flash notice:</p><pre><code>  if @user.save
    flash[:'notice'] = &quot;New user saved successfully.&quot;
  elsif !@user.errors.empty?
    flash[:'notice'] = &quot;Could not save new user: &quot;
        &lt;&lt; @user.errors.full_messages.join(&quot;; &quot;)
  end
</code></pre></article><article><h2>Ruby and Rails</h2><p>So. I'm fiddling. again. with Ruby on Rails. because it's trendy.</p><p>I have to say, it's also handy. Very nice not to have to write the entire DB framework just to make an app! The problem that I have is I'm such a habitual programming dork that I find Ruby's syntax a little odd...</p><ul><li>Ruby Language<ul><li><a href=http://www.rubycentral.com/book/>The Pragmatic Programmer's Guide</a></li><li><a href=http://poignantguide.net/ruby/>Why's (Poignant) Guide to Ruby</a></li></ul></li><li>Ruby on Rails<ul><li><a href=http://api.rubyonrails.org/>Ruby on Rails <span class=caps>API</span></a> <span class=attribute>[<a href=http://api.rubyonrails.org/>api.rubyonrails.org</a>]</span></li><li><a href=http://discuss.joelonsoftware.com/default.asp?joel.3.309321.3>Rails rant..</a> <span class=attribute>[<a href=http://discuss.joelonsoftware.com/>discuss.joelonsoftware.com</a>]</span></li><li><a href=http://jgchristopher.blogspot.com/2005/09/ruby-on-rails-editing-multiple-rows-of.html>Editing multiple rows on one form</a> <span class=attribute>[<a href=http://jgchristopher.blogspot.com>jgchristopher.blogspot.com</a>]</span></li><li><a href=http://www.fivesevensix.com/posts/rails>Rails code snippets, etc.</a> <span class=attribute>[<a href=http://fivesevensix.com>fivesevensix.com</a>]</span></li></ul></li><li>Tutorials<ul><li><a href=http://www.digitalmediaminute.com/article/1816/top-ruby-on-rails-tutorials>Top 12 Ruby Tutorials</a> <span class=attribute>[<a href=http://www.digitalmediaminute.com/>www.digitalmediaminute.com</a>]</span></li><li><a href=http://www.onlamp.com/pub/a/onlamp/2005/01/20/rails.html>Rolling with Ruby on Rails</a> <span class=attribute>[<a href=http://www.onlamp.com/>onlamp.com</a>]</span></li><li><a href=http://www.onlamp.com/pub/a/onlamp/2005/03/03/rails.html>Rolling with Ruby on Rails, Part II</a> <span class=attribute>[<a href=http://www.onlamp.com/>onlamp.com</a>]</span></li><li><a href=http://instantrails.rubyforge.org/tutorial/index.html>Instant Rails: Rolling with Ruby</a> <span class=attribute>[<a href=http://instantrails.rubyforge.org>instantrails.rubyforge.org</a>]</span></li><li><a href=http://routes.groovie.org/manual.html>Routes manual</a> <span class=attribute>[<a href=http://routes.groovie.org>routes.groovie.org</a>]</span></li></ul></li><li>Cheat Sheets<ul><li><a href=http://blog.invisible.ch/files/rails-reference-1.1.html>InVisible Rails Reference</a> <span class=attribute>[<a href=http://blog.invisible.ch/>blog.invisible.ch</a>]</span></li><li><a href=http://lhalff.backpackit.com/pub/106727>Rails Cheat Sheet</a> <span class=attribute>[<a href=http://lhalff.backpackit.com>lhalff.backpackit.com</a>]</span></li><li><a href=http://www.ilovejackdaniels.com/ruby-on-rails/ruby-on-rails-cheat-sheet/>Ruby on Rails cheat sheet</a> <span class=attribute>[<a href=http://www.ilovejackdaniels.com/>www.ilovejackdaniels.com</a>]</span></li><li><a href=http://www.blainekendall.com/uploads/RubyOnRails-Cheatsheet-BlaineKendall.pdf>Ruby on rails cheat sheet</a> <span class=attribute>[<a href=http://www.blainekendall.com/>www.blainekendall.com</a>]</span></li><li><a href=http://garrettsnider.backpackit.com/pub/367902>Rails Migration Cheat Sheet</a> <span class=attribute>[<a href=http://garrettsnider.backpackit.com/>garrettsnider.backpackit.com</a>]</span></li></ul></li><li>Using Relational DB<ul><li><a href=http://encytemedia.com/blog/articles/2005/06/15/storing-additional-data-on-join-tables-with-rails>Data in Join tables</a> <span class=attribute>[<a href=http://encytemedia.com/>encytemedia.com</a>]</span></li><li><a href=http://wiki.rubyonrails.com/rails/pages/TutorialBasicRelational>Basic Relational stuff</a> <span class=attribute>[<a href=http://wiki.rubyonrails.com/>wiki.rubyonrails.com</a>]</span></li><li><a href=http://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html>ActionRecord::Associations</a> <span class=attribute>[<a href=http://api.rubyonrails.org/>api.rubyonrails.org</a>]</span></li></ul></li><li>Migrations<ul><li><a href=http://wiki.rubyonrails.com/rails/pages/UnderstandingMigrations>Understanding Migrations</a> <span class=attribute>[<a href=http://wiki.rubyonrails.com>wiki.rubyonrails.com</a>]</span></li><li><a href=http://wiki.rubyonrails.com/rails/pages/UsingMigrations>Using Migrations</a> <span class=attribute>[<a href=http://wiki.rubyonrails.com>wiki.rubyonrails.com</a>]</span></li><li><a href=http://api.rubyonrails.com/classes/ActiveRecord/Migration.html>Migration</a> <span class=attribute>[<a href=http://api.rubyonrails.com>api.rubyonrails.com</a>]</span></li><li><a href=http://api.rubyonrails.com/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#M000517>Schema statements</a> <span class=attribute>[<a href=http://api.rubyonrails.com>api.rubyonrails.com</a>]</span></li><li><a href=http://rails.techno-weenie.net/question/2006/3/19/table_structure_and_models_foreign_keys_and_references>Foreign keys and references</a> <span class=attribute>[<a href=http://rails.techno-weenie.net/>rails.techno-weenie.net</a>]</span></li></ul></li></ul></article><article><h2>Gentoo/T40: Nailing down wireless config</h2><p>Gathering some links to get wireless working (better) on my <span class=caps>T40.</span> I'm trying to figure out how to get some semblance of roaming... <strong>sigh</strong></p><p><em>References:</em></p><ul><li><a href=http://gentoo-wiki.com/HOWTO_Wireless_Configuration_and_Startup><span class=caps>HOWTO</span> Wireless Configuration and Startup</a> <span class=attribute>[<a href=http://gentoo-wiki.com>gentoo-wiki.com</a>]</span></li><li><a href="http://www.gentoo.org/doc/en/handbook/handbook-x86.xml?part=4&chap=4">Wireless Networking</a> <span class=attribute>[<a href="http://www.gentoo.org/doc/en/handbook/handbook-x86.xml?part=0&chap=0">Gentoo Linux Handbook</a>]</span></li></ul></article><article><h2>TXP Hack: centralizing priv lookups</h2><p>I use <span class=caps>HTTP</span> Auth for one of my Textpattern installations, and so, I wanted people that could get to the textpattern pages to have, by default, staff writer permissions.</p><h3>Checking Privledges</h3><p>In Textpattern 1.0 (rc1-3), check_privs returns a message if the requested privs are not present. There is no way to non-destructively check privledges.</p><p>I made the following changes to lib/txp_misc.php:</p><pre><code>function check_privs()
{
  global $txp_user;
  $args = func_get_args();

  // Change check for privs to call new method, has_privs
  $result = call_user_func_array('has_privs', $args);

  if( !$result )
  {
    exit(pageTop('Restricted').
         '&lt;p style=&quot;margin-top:3em;text-align:center&quot;&gt;'.
         gTxt('restricted_area').'&lt;/p&gt;');
  }
}

// New method - non-desructively checks for given privs
// Also sets privs retrieved from DB in a global to reduce DB load
function has_privs()
{
  global $myprivs, $txp_user;

  if ( !isset($myprivs) || empty($myprivs) )
  {
    $myprivs = safe_field('privs', 'txp_users', &quot;name = '$txp_user'&quot;);

    // if we didn't find privs in the DB, assign default of 4 (Staff Writer)
    if ( empty($myprivs) &amp;&amp; isset($_SERVER['REMOTE_USER'])
      $myprivs = 4;
  }

  // Get requested privs, and test requested privs
  // against assigned privs..

  $args = func_get_args();

  if ( in_array($myprivs,$args) )
    return true;

  return false;
}
</code></pre><h3>Centralizing priv lookups.</h3><p>The next part is to change lookups for privs (which look something like this:</p><p><code>$myprivs = safe_field('privs', 'txp_users', "name = '$txp_user'");</code></p><p>To call the new <code>has_privs</code> method instead.</p></article><article><h2>TXP Hack: Using TXP Excerpts like MT</h2><p>One of the things I used heavily in MT was the body/extended body trick. I wanted to continue that with Textpattern, but it involved some hacks to how <span class=caps>TXP </span>handles excerpts.</p><p><span class=attribute>[Based on Textpattern 1.0rc1]</span></p><ol><li>Add an additional column, Excerpt_html, to the textpattern table so that Excerpt has the same behavior as the body (original textile is saved, with the html result in the _html column).<ul><li>Change to <code>txpsql.php</code>:<pre><code>  --- txpsql.php  23 Jan 2005 02:40:40 -0000      1.1
  +++ txpsql.php  6 Feb 2005 17:44:33 -0000       1.2
  @@ -19,6 +19,7 @@
     `Body` text NOT NULL,
     `Body_html` text NOT NULL,
     `Excerpt` mediumtext NOT NULL,
  +  `Excerpt_html` mediumtext NOT NULL,
     `Image` varchar(255) NOT NULL default '',
     `Category1` varchar(128) NOT NULL default '',
     `Category2` varchar(128) NOT NULL default '',
</code></pre></li><li>Change to <code>_update.php</code>:<pre><code>  --- _update.php 23 Jan 2005 02:40:40 -0000      1.1
  +++ _update.php 6 Feb 2005 17:43:05 -0000       1.2
  @@ -50,6 +50,10 @@
          if (!in_array('Excerpt',$txp)) {
                  safe_alter(&quot;textpattern&quot;, &quot;add `Excerpt` mediumtext not null after `Body_html`&quot;);
          }
  +
  +       if (!in_array('Excerpt',$txp)) {
  +               safe_alter(&quot;textpattern&quot;, &quot;add `Excerpt_html` mediumtext not null after `Excerpt`&quot;);
  +       }
</code></pre></li><li>In order to have _update.php run (to add the column to an existing textpattern table), temporarily change <code>$thisversion</code> in <code>textpattern/index.php</code> to '0'. _update.php will run the next time you do anything with <code>textpattern/index.php</code>. Once it runs, return <code>$thisversion</code> to its original value.</li></ul></li><li>Make <code>textpattern/include/txp_article.php</code> store the raw textile text and the html formatted text separately. Also, since I am used to writing the excerpt and then the body, I moved the excerpt box above the body box on the entry form.
This diff is a little more involved, I've attached it <a href=/files/excerpt_html.txp_article.diff.txt>here</a>.<br></li><li>Finally, we need to make <code>textpattern/publish.php</code> display <code>Excerpt_html</code> instead of <code>Excerpt</code>. The diff is <a href=/files/excerpt_html.publish.diff.txt>here</a>.</li></ol><p>For the full article display, use <code>&lt;txp:excerpt /></code> and <code>&lt;txp:body /></code>. To show just the excerpt, use <code>&lt;txp:excerpt />.</code></p><p>I selectively show a "[more]" link based on whether or not there is additional body text. If an entry is really short, sometimes there is only an excerpt. I created my own plugin to do this, and it looks like this:</p><pre><code>function elh_article_more($atts)
{
    global $thisarticle;
    if (is_array($atts)) extract($atts);

    $body = $thisarticle['body'];
    if ( !preg_match(&quot;/w/&quot;, $body) )
        return '';

    $link = '&lt;a href=&quot;'.$thisarticle['permlink'].'&quot;&gt;more&lt;/a&gt;';

    return '&lt;div class=&quot;more&quot;&gt;['.$link.']&lt;/div&gt;';
}
</code></pre><p>Have Fun!</p></article><article><h2>TXP Hack: MT-Macro like function in textpattern</h2><p>This is a simple hack to add one of my favorite MT-plugins, Brad Choate's <a href=http://www.bradchoate.com/weblog/2002/08/12/mtmacro><span class=caps>MTM</span>acros</a> <span class=attribute>[<a href=http://www.bradchoate.com>bradchoate.com</a>]</span>, to textpattern.</p><p>Granted, I didn't pull the entire kaboodle. This doesn't do fun container logic and acronym matching, etc. But it does do simple string replacement, which is what I used it for (e.g. smilies and pretty attributions).</p><p><span class=attribute>[Based on Textpattern 1.0rc1]</span></p><ul><li><a href=#classTextile>Using macros with original <code>lib/classTextile.php</code></a></li><li><a href=#textilePHP>Using macros with <code>TextilePHP</code></a></li></ul><h3><a name=classTextile></a>Using macros with original <code>lib/classTextile.php</code></h3><p>I add one method to <code>lib/classTextile.php</code> (either the original, or the modified version provided by Colin Brown<sup class=footnote><a href=#fn1>1</a></sup> that provides extended blocks, escaped blocks, and better handling of &lt;pre> tags).</p><pre>
    /**
     * Performs string replacement based on a provided
     * array containing 'pattern' =&gt; 'replacement' pairs.
     *
     * @parameter string $text Text to process
     * @parameter string $list Name of global variable containing
     *                         array of pattern/replacement pairs.
     */
    function customMacros($text, $list)
    {
        $macros = $GLOBALS[$list];

        if ( isset($macros) &amp;&amp; is_array($macros) )
        {
            $patterns = array_keys($macros);
            $replace = array_values($macros);
            $text = str_replace($patterns, $replace, $text);
        }
        return $text;
    }
</pre><p>I added two calls to this method within the <code>TextileThis</code> method of <code>lib/classTextile.php</code>.</p><p>The first is just after we mark that text which should not be textiled:</p><pre>
    $text = $this-&gt;customMacros($text, 'pre_macros');
</pre><p>This expands macros before other textile substitutions.</p><p>The second is just before the &lt;notextile> tags are replaced (it could also be just after):</p><pre>
    $text = $this-&gt;customMacros($text, 'post_macros');
</pre><p>The second parameter passed to the <code>textileMacros</code> method is the name of a global environment variable holding an array of macro definitions (e.g. pre_macros or post_macros). You can change these names to suit, but the array declaration (given what is above) should look something like this:</p><pre>
  global $pre_macros, $post_macros;

  $pre_macros = array(
    '=&amp;#41;'  =&gt; '&amp;lt;img src=&quot;/cheesy.gif&quot; /&gt;',
   '&amp;lt;/z&gt;' =&gt; ' &amp;lt;/q&gt;',
          );


  $post_macros = array(
    '&amp;lt;z&gt;'  =&gt; '&amp;lt;span class=&quot;attribute&quot;&gt;[',
   ' &amp;lt;/q&gt;' =&gt; ']&amp;lt;/span&gt;',
           );
</pre><p>I use a custom tag to generate formatted attribution text, e.g. &lt;z>"link.com":http://link.com&lt;/z> generates &lt;span class="attribute>[&lt;a href="link.com">link.com&lt;a>]&lt;/span>.</p><p>The combination of pre/post tags adjusts spacing to allow textpattern to properly work around my custom tag.</p><h3><a name=textilePHP></a>Using macros with original <code>TextilePHP</code></h3><p>This also works with <a href=http://jimandlissa.com/project/textilephp>TextilePHP</a> <span class=attribute>[<a href=http://jimandlissa.com>jimandlissa.com</a>]</span>.</p><p>I made the following updates to their class:</p><ul><li>Added <code>TextileThis</code>, as others have done<sup class=footnote><a href=#fn2>2</a></sup>, to make it <span class=caps>TXP </span>compatible.</li><li>Added <code>customMacros</code> method, as above, with two calls for pre-textile processing, and post-textile processing.<ul><li><code>$str = $this->customMacros($str, 'pre_macros');</code><br>'pre_macros' are used just before the check for disabled html</li><li><code>$out = $this->customMacros($str, 'post_macros');</code><br>'post_macros' are used just before the cleanup to<br>restore preserved blocks.</li></ul></li></ul><pre>
  /**
   * Wrapper function for compatibility with TXP
   */
  function TextileThis($text, $lite='', $encode='', $noimage='', $strict='')
  {
    if (get_magic_quotes_gpc())
           $text = stripslashes($text);

    if ( $encode )
        return $this-&gt;encode_html_basic($text);

    if ( $lite )
        $this-&gt;disable_html(true);

    return $this-&gt;process($text);
  } // function TextileThis
</pre><h3>Footnotes</h3><p class=footnote id=fn1><sup>1</sup> <a href=http://www.solarorange.com/projects/textile/>Unofficial Textile 2.0 beta</a> <span class=attribute>[<a href=http://www.solarorange.com>solarorange.com</a>]</span>, from <a href="http://forum.textpattern.com/viewtopic.php?id=2285">this thread</a> <span class=attribute>[<a href=http://forum.textpattern.com>forum.textpattern.com</a>]</span>.</p><p class=footnote id=fn2><sup>2</sup> <a href=http://greenrift.textdrive.com/projects/9/textilephp-for-txp>TextilePHP for <span class=caps>TXP</span></a> <span class=attribute>[<a href=http://greenrift.textdrive.com>greenrift.textdrive.com</a>]</span>, as mentioned in <a href="http://forum.textpattern.com/viewtopic.php?id=2059">this thread</a> <span class=attribute>[<a href=http://forum.textpattern.com>forum.textpattern.com</a>]</span>.</p></article><article><h2>Cleaning up gentoo...</h2><p>Those distfiles&mldr; /usr/portage/distfiles can get pretty big, and cleaning it out periodically can save a lot of disk space. The brute force approach is to just clear out the whole thing, which can be more practical if you have a fast connection. If redownloading what you need is no big deal, then cleaning out distfiles can be the faster way to go.</p><p>Alternatively, there are some scripts floating around to help you clean out the distfiles (and the other uncleaned up crap) for things that aren't currently installed (old versions, etc).</p><h4 id=references>References</h4><ul><li><a href=http://gentoo-wiki.com/TIP_Clean_Up_Cruft>TIP Clean Up Cruft</a> [gentoo-wiki.com]</li></ul><p>From [forums.gentoo.org]:</p><ul><li>Cleaning out stale distfiles</li><li>Portage Utilities Not in Portage</li><li>Experimental Gentoo Scripts</li><li>Filesystem cruft script: clean your system, save disk space! [forums.gentoo.org]</li></ul></article><article><h2>IBM T40 and multi-channel audio (ALSA)</h2><p>I'm finally getting around to setting up multi-channel audio. I've had this machine for awhile now, and most things are humming along.</p><p><em>References</em></p><ul><li><a href="http://opensrc.org/alsa/index.php?page=intel8x0">intel8&#215;0 – multichannel mixing</a> <span class=attribute>[<a href=http://opensrc.org>opensrc.org</a>]</span></li><li><a href="http://alsa.opensrc.org/index.php?page=DmixPlugin">dmix plugin</a> <span class=attribute>[<a href=http://alsa.opensrc.org>alsa.opensrc.org</a>]</span></li><li><a href=http://thread.gmane.org/gmane.linux.hardware.thinkpad/11358>T40 and ALSA, but no multichannel mixing</a> <span class=attribute>[thread on <a href=http://www.gmane.org>gmane.org</a>]</span></li></ul></article><article><h2>Handy CD reading/writing/ripping stuff</h2><p><a href=http://www.cpqlinux.com/cdrw.html><span class=caps>ISO, CDR, </span>and <span class=caps>CDRW </span>in Linux</a> <span class=attribute>[<a href=http://www.cpqlinux.com/sitemap.html>cpqlinux.com</a>]</span></p><p>An old page, but full of handy tips (more like quick references) nonetheless.</p><p>Just in case, it's also <a href=http://web.archive.org/web/20040219093901/http://www.geocities.com/rlcomp_1999/cdrw.html>here.</a> <span class=attribute>[<a href=http://www.waybackmachine.org title=WaybackMachine>waybackmachine.org</a>]</span></p><p>Also:</p><ul><li><a href=http://gentoo-wiki.com/HOWTO_ATAPI_CD_Burning><span class=caps>HOWTO ATAPI</span> CD Burning</a> <span class=attribute>[<a href=http://gentoo-wiki.com>gentoo-wiki.com</a>]</span></li><li><a href=http://www.debian-administration.org/articles/333 title=IDE>CD burning with a 2.6 kernel</a> <span class=attribute>[<a href=http://www.debian-administration.org/>www.debian-administration.org</a>]</span></li></ul></article><article><h2>ACPI on IBM T40 with 2.6 kernel</h2><p>OK. getting ACPI to work properly needed to be revisited.</p><p><a href=http://bellet.info/laptop/t40.html#suspend_resume>Suspend/Resume on T40</a> <span class=attribute>[<a href=http://bellet.info/>bellet.info</a>]</span></p><p>This guy originally used APM, but his update on 2004/07/15 makes some good notes, which I followed, notably:</p><ul><li>Local APIC is required for USB to function properly, but it borks all over suspend/poweroff processing. There is a simple enough referenced patch to make it behave&#8230;</li></ul></article><article><h2>Gentoo on an IBM T40</h2><p>So, I have gentoo up and running on my T40, and thought I'd share the resources that helped me get there.</p><p>For those interested, here's the currently running kernel <a href=/files/config-2.6.7-gentoo-r11 title=2.6.7-gentoo-r11>config</a>.</p><p><em><strong>Preparation:</strong></em><br>I wiped the predesktop area. I don't plan on running windows, and I'd rather have the disk space, thanks.</p><p><em><strong>2.6 Kernel / Modules:</strong></em></p><ul><li><strong>Power Management</strong> – I stuck with <span class=caps>APM</span> rather than <span class=caps>ACPI</span>. I may try <span class=caps>ACPI</span> later, but not yet.</li><li><strong>Graphics Support</strong> – I went with framebuffer support this time, and so far, I like it.<br>Make sure you compile framebuffer console support <span class=caps>INTO</span> the kernel.</li><li><strong>Sound Support</strong> – Alsa + snd_i8&#215;0, as usual</li><li><strong>Networking</strong><ul><li>e1000 driver worked out of the box for the on-board Ethernet card</li><li><strong>There is a new <a href=http://ipw2100.sourceforge.net/>SF project</a> providing a driver for the onboard Intel Corp. <span class=caps>PRO</span>/Wireless <span class=caps>LAN</span> 2100 card.</strong> The driver seems to work fine, I've not been using it long enough to complain.. ;) Also, there is a <a href="http://forums.gentoo.org/viewtopic.php?t=122435&postdays=0&postorder=asc&start=1075&sid=f1d28c7b904951f6d8a4e4ac6368b5b6">nice ebuild</a> for centralizing wireless config. Sweet!<ul><li>emerge wireless-tools</li><li>emerge <a href="http://forums.gentoo.org/viewtopic.php?t=122435&postdays=0&postorder=asc&start=1075&sid=f1d28c7b904951f6d8a4e4ac6368b5b6">wireless-config</a></li><li>tweak /etc/conf.d/net and /etc/conf.d/wireless as recommended by wireless-config package<br>Noteable: associate_test_eth1="MAC" was required to allow dhcp to finish initializing. I also provided wireless dhcp settings in /etc/conf.d/wireless rather than in /etc/conf.d/net.</li><li>/etc/init.d/net.eth1 start</li></ul></li></ul></li></ul><pre><code>iwconfig  (before setting any wireless stuff up)
lo        no wireless extensions.
</code>
<code>eth0      no wireless extensions.
</code>
<code>eth1      IEEE 802.11b  ESSID:&quot;&quot;  Nickname:&quot;ipw2100&quot;
          Mode:Managed  Channel:1  Access Point: 00:00:00:00:00:00
          Bit Rate=0kb/s   Tx-Power=32 dBm
          Retry:on   RTS thr=2304 B   Fragment thr:off
          Encryption key:off
          Power Management:off
          Link Quality:0/100  Signal level:-66 dBm  Noise level:-98 dBm
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:0   Missed beacon:0
</code></pre><p><em><strong>lspci</strong></em></p><pre><code>0000:00:00.0 Host bridge: Intel Corp. 82855PM Processor to I/O Controller (rev 03)
0000:00:01.0 PCI bridge: Intel Corp. 82855PM Processor to AGP Controller (rev 03)
0000:00:1d.0 USB Controller: Intel Corp. 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M) USB UHCI Controller #1 (rev 01)
0000:00:1d.1 USB Controller: Intel Corp. 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M) USB UHCI Controller #2 (rev 01)
0000:00:1d.2 USB Controller: Intel Corp. 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M) USB UHCI Controller #3 (rev 01)
0000:00:1d.7 USB Controller: Intel Corp. 82801DB/DBM (ICH4/ICH4-M) USB 2.0 EHCI Controller (rev 01)
0000:00:1e.0 PCI bridge: Intel Corp. 82801 PCI Bridge (rev 81)
0000:00:1f.0 ISA bridge: Intel Corp. 82801DBM LPC Interface Controller (rev 01)
0000:00:1f.1 IDE interface: Intel Corp. 82801DBM (ICH4) Ultra ATA Storage Controller (rev 01)
0000:00:1f.3 SMBus: Intel Corp. 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M) SMBus Controller (rev 01)
0000:00:1f.5 Multimedia audio controller: Intel Corp. 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M) AC&#39;97 Audio Controller (rev 01)
0000:00:1f.6 Modem: Intel Corp. 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M) AC&#39;97 Modem Controller (rev 01)
0000:01:00.0 VGA compatible controller: ATI Technologies Inc Radeon R250 Lf [Radeon Mobility 9000 M9] (rev 02)
0000:02:00.0 CardBus bridge: Texas Instruments PCI1520 PC card Cardbus Controller (rev 01)
0000:02:00.1 CardBus bridge: Texas Instruments PCI1520 PC card Cardbus Controller (rev 01)
0000:02:01.0 Ethernet controller: Intel Corp. 82540EP Gigabit Ethernet Controller (Mobile) (rev 03)
0000:02:02.0 Network controller: Intel Corp. PRO/Wireless LAN 2100 3B Mini PCI Adapter (rev 04)
</code></pre><p><em><strong>References:</strong></em></p><ul><li><a href=http://www.cs.utexas.edu/users/walter/geek/linux-t40.html title="Walter Chang">Linux on the <span class=caps>IBM</span> Thinkpad T40</a></li><li><a href=http://www.ontheedge.ch/t40p.html>Gentoo linux on a Thinkpad T40p</a></li><li><a href=http://bellet.info/laptop/t40.html title="Fabrice Bellet">Linux on the Thinkpad T40</a></li><li><a href=http://www.enyo.de/fw/hardware/thinkpad/ title="Florian Weimer">Linux on the Thinkpad T40p</a> – <em>includes <span class=caps>ACPI</span> and Multihead X</em></li></ul><ul><li><a href=http://tpctl.sourceforge.net/>Thinkpad Configuration Tools for Linux</a></li><li><a href=http://news.gmane.org/gmane.linux.hardware.thinkpad>thinkpad-linux archives</a></li><li><a href=http://www.linux-on-laptops.com/ibm.html>linux-on-laptops: <span class=caps>IBM</span></a></li><li><a href=http://ipw2100.sourceforge.net/>Intel&#174; <span class=caps>PRO</span>/Wireless 2100 Driver for Linux</a></li><li><a href="http://forums.gentoo.org/viewtopic.php?t=122435&postdays=0&postorder=asc&start=1075&sid=f1d28c7b904951f6d8a4e4ac6368b5b6">wireless-config ebuild</a></li><li><a href=http://theorie.physik.uni-wuerzburg.de/~arwagner/computer/T41p/>Linux on <span class=caps>IBM</span> T41p</a></li></ul><p><em><strong>Other Notes:</strong></em></p><ul><li><a href=http://www.gentoo.org/doc/en/xorg-config.xml>Gentoo: The X Server Configuration <span class=caps>HOWTO</span></a></li><li><a href=http://www.gentoo.org/doc/en/alsa-guide.xml>Gentoo: Gentoo Linux <span class=caps>ALSA</span> Guide</a></li><li><a href=http://lists.debian.org/debian-laptop/2003/08/msg00120.html>console framebuffer [Solved]</a></li><li><a href=http://bluszcz.jabberpl.org/radeon_dri_howto.txt>radeon <span class=caps>DRI</span> howto</a></li><li><a href=http://gentoo-wiki.com/HOWTO_APM_Suspend>Gentoo: Howto <span class=caps>APM</span> Suspend</a></li><li><a href=http://freedesktop.org/~xorg/X11R6.7.0/doc/xorg.conf.5.html>X.org: xorg.conf (5) manpage</a></li><li><a href="http://forums.gentoo.org/viewtopic.php?t=175419">Gentoo Forums: Linux Memory Management or &#8216;Why is there no free <span class=caps>RAM</span>?'</a> – also, why you may not see some of your <span class=caps>RAM</span> (i.e. amounts over ~800M)</li><li><a href="{{site.baseurl}}{% link _posts/2004-01-20-linuxt23-dual-monitors.html %}/">T23 and Dual Monitors</a></li></ul><p><em><strong>X Font Server and X11:</strong></em></p><p>Finally, an email that concisely explains what the hell &#8216;unix:/7100' actually <span class=caps>DOES</span>&#8230;</p><p><a href=http://www.mail-archive.com/linux-il@cs.huji.ac.il/msg15131.html>X Font Problem</a></p><blockquote><p>From: Nadav Har'El</p><p>On Mon, Jul 09, 2001, Alexander V. Karelin wrote about
"Re: X font problem":<br>> 1. The unix/:-1 thing is very simple. unix stands for transport. / has to<br>> preceed the hostname. If the host is local, than the column follows the<br>> slash. And the last part is the number of the port, which for unix<br>> sockets, is -1. So – if You want to use Your font-server's resources – > first check which transport/port does it serve on. And than add it to the<br>> fontpath.</p><p>&#8230;</p><p>Anyway, what I'm trying to say is that -1 isn't exactly a port number, but<br>rather a hint the X server and/or font server use to find this file.<br>For example, in my Redhat 7.1 installation, I have in XF86CONFIG
FontPath &#8220;unix/:7100&#8221;</p><p>This 7100 is not a port number, since unix-domain sockets do not have<br>port numbers (an example where this would have been a port is with the<br>tcp transport: tcp/somecomputer.com:7100 – see man X(7) for more info).<br>This 7100 tells X to use the local file:<ol><li>ls -l /tmp/.font-unix/fs7100<br>srwxrwxrwx 1 xfs xfs 0 Jul 9 23:15 /tmp/.font-unix/fs7100</li></ol></p><p>Which the font server (xfs) is listening on. Note the &#8220;s&#8221; in the beggining<br>of the ls -l line: this says this is a special unix-domain *s*ocket file.</p></blockquote></article><article><h2>TOYS!</h2><p>I got a Sony Clie PEG-TJ37. I was thinking about the PEG-TJ55, but I just could NOT deal with the wheel thing in the back – too awkward.</p><p>Since the info on getting this puppy to work with linux seemed a little scattered, I figured I'd make my notes here, maybe someone else would find them handy, too.</p><p>Just as a side comment, syncing with jpilot worked oddly until I changed from devfs to udev (I left devfs in the kernel, but used the boot option to prevent it from being mounted). Once I switched to udev, behavior made much more sense.</p><p>linux distro: <code>gentoo</code><br>kernel version: <code>2.6.5-gentoo-r1 (gentoo-dev-sources)</code></p><p>kernel options:</p><pre><code>  CONFIG_USB=y
  CONFIG_USB_DEVICEFS=y
  CONFIG_USB_EHCI_HCD=m
  CONFIG_USB_UHCI_HCD=y
  CONFIG_USB_SERIAL=m
  CONFIG_USB_SERIAL_VISOR=m
</code></pre><p><em>References:</em></p><ul><li><a href=http://www.gentoo.org/doc/en/udev-guide.xml>Gentoo UDev Guide</a></li><li><a href=http://www.monkeynoodle.org/comp/clie-ms>Using a Clie's Memory Stick with Linux</a></li><li><a href=http://nick.kreucher.net/clie/survey-results.php>Sony Cli&#233;and Linux Survey Results</a>, <a href=http://nick.kreucher.net/clie/>Sony Cli &#233;and Linux</a></li><li><a href=http://pilot-link.org/README.usb>http://pilot-link.org/README.usb</a></li><li><a href=http://wiki.pilot-link.org/title/Palm+Device+Matrix>Palm Device Matrix – pilot-link Community Portal</a></li><li><a href=http://homepages.nildram.co.uk/~milnber/cliehowto.html>Sony Cli&#233; HOWTO</a></li><li><a href=http://news.gmane.org/gmane.comp.handhelds.clie.linux/>clie-linux mailing list archives</a></li><li><a href=http://www.geniusweb.com/LDP/HOWTO/Wireless-Sync-HOWTO/>Wireless Sync HOWTO</a></li><li><a href=http://www.nicholson.com/rhn/palm/pdb.txt>PDB Formats</a></li><li><a href=http://www.geocities.com/Heartland/Acres/3216/palmrecs.htm>Palm Desktop File Formats</a></li></ul></article><article><h2>2.6.3 Kernel on IBM T23</h2><p>Well, this is first pass, I'll record it anyway.</p><p><span class=caps>APM</span> doesn't work – suspend does strange things.</p><p>alsasound in the kernel works well – used mm-sources, and everything went smoothly. I don't remember any major issues.</p><p><a href=/files/config-2.6.3-rc1-mm1.txt>config-2.6.3-rc1-mm1</a></p><p>Notes on <span class=caps>APM</span> with 2.6 kernel:<br><a href=http://mailman.linux-thinkpad.org/pipermail/linux-thinkpad/2003-December/014828.html lang=ltp>T23 suspend – 2.6.0 final</a><br><a href=http://mailman.linux-thinkpad.org/pipermail/linux-thinkpad/2003-December/014832.html lang=ltp title=Alsa>T23 suspend – 2.6.0 final</a></p></article><article><h2>Helpful stuff for kernel 2.6.x and X (mice/keyboard)</h2><p><a href=http://kerneltrap.org/node/view/2199>Linux: 2.6 Input Drivers FAQ</a></p><p>Didn't want to lose it.. <img alt=:-) src=/images/smilies/grin.gif class=icon></p><p>Additional keyboard stuff:</p><ul><li><a href=http://www.tldp.org/HOWTO/Keyboard-and-Console-HOWTO-15.html>Keyboard-and-Console-HOWTO</a></li></ul></article><article><h2>Linux/T23 - Dual Monitors</h2><p>Trying to get dual monitors working..</p><p><strong>References:</strong></p><ol><li><a href=http://www.spinics.net/lists/xf-xpert/msg04476.html><span class=caps>IBM</span> P70 Monitor Example</a></li><li><a href=http://www.enyo.de/fw/hardware/thinkpad/#3>Running <span class=caps>GNU</span>/Linux on the <span class=caps>IBM</span> ThinkPad T40p</a></li><li><a href=http://lists.samba.org/archive/linux/2002-January/001714.html>Sample .xsession</a></li><li><a href=http://thread.gmane.org/gmane.linux.hardware.thinkpad/7028 lang=ltp>Dual/MultiHead setup</a></li><li><a href=http://thread.gmane.org/gmane.linux.hardware.thinkpad/5615 lang=ltp>T40p+multihead</a></li></ol><p><strong>Update – 2004-01-22</strong></p><p>Well crap. All that research, and the Savage driver for the T23 just plain won't do dual display.</p><p>I'll have to wait for my upgrade..</p></article><article><h2>CDRW on IBM T23 with Gentoo</h2><p>Didn't notice until now that my CD-RW/DVD player wasn't loading properly – you can tell how much I use it, eh? <img alt=;-) src=/images/smilies/wink2.gif class=icon></p><p>I'd already built the kernel with the correct SCSI modules (see references, below). I'd also already added <code>"hdc=ide-scsi"</code> to my grub boot parameters.</p><p>What was left was the following:</p><p><code>/etc/devfsd.conf:</code></p><ol><li>uncommented:<pre><code># Give the cdrw group write permissions to /dev/sg0
# This is done to have non root user use the burner (scan the scsi bus)
REGISTER    ^scsi/host.*/bus.*/target.*/lun.*/generic PERMISSIONS root.cdrw 660</code></pre><li>commented out:<pre><code># Create /dev/cdrom for the first cdrom drive
#LOOKUP     ^cdrom$         CFUNCTION GLOBAL mksymlink cdroms/cdrom0 cdrom
#REGISTER   ^cdroms/cdrom0$ CFUNCTION GLOBAL mksymlink $devname cdrom
#UNREGISTER ^cdroms/cdrom0$ CFUNCTION GLOBAL unlink cdrom</code></pre><li>uncommented the following:<pre><code># Create /dev/cdrw for the first cdrom on the scsi bus
# (change &#8216;sr0' to suite your setup)
LOOKUP      ^cdrw$          CFUNCTION GLOBAL mksymlink sr0 cdrw
REGISTER    ^sr0$           CFUNCTION GLOBAL mksymlink $devname cdrw
UNREGISTER  ^sr0$           CFUNCTION GLOBAL unlink cdrw</code></pre></li></ol><p>Result:</p><pre><code># cdrecord -scanbus
Cdrecord 2.01a14 (i686-pc-linux-gnu) Copyright&#169; 1995-2003 Jörg Schilling
Linux sg driver version: 3.1.24
Using libscg version 'schily-0.7'
scsibus0:
    0,0,0  0) &#8216;MATSHITA' &#8216;UJDA720 DVD/CDRW' '1.03' Removable CD-ROM
    0,1,0  1) *
    0,2,0  2) *
    0,3,0  3) *
    0,4,0  4) *
    0,5,0  5) *
    0,6,0  6) *
    0,7,0  7) *
</code></pre><p>YAY! <img alt=:-) src=/images/smilies/grin.gif class=icon></p><p>References:</p><ul><li><a href=http://zeppox.ath.cx/~jackson/stuff/notes/gentoo_cdrw_notes.html>How to get a CD-RW and CDROM working using Gentoo</a></li></ol></li></ul></article><article><h2>Fixing Sound/Suspend-Resume on IBM T23 for Gentoo</h2><p><span class=caps>ALSA</span> does work, as I mentioned <a href="{{site.baseurl}}{% link _posts/2003-09-21-dammit-gentoo-on-t23-continued.html %}">here</a>, but it seems to have problems across a suspend-resume, i.e. it doesn't work post-resume.</p><p>Previously used patches don't seem to apply to newer Alsa modules.</p><p>Gentoo installs apmd_proxy in /etc/apm, with suspend.d and resume.d directories for handling special suspend/resume operations. Even better, event.d handles both.</p><p>So, based on some searching around, I ended up adding apmd to the list of services to start (<code>rc-update add apmd default</code>), and added the following script to get alsa to behave on resume:</p><blockquote><p><b><code>/etc/apm/event.d/alsa:</code></b><br><pre>#!/bin/sh

case &quot;$1&quot; in
resume)
    /usr/sbin/alsactl power off
    /usr/sbin/alsactl power on
    ;;
suspend|standby)
    ;;
esac </pre></p></blockquote><p>Found this lovely snippet that answers why <code>apm -s</code> works better than <code>Fn-F4</code> [emphasis added]:</p><blockquote><p>The <span class=caps>APM</span> <span class=caps>BIOS</span> rejects suspend (or hibernate) requests under certain conditions: e.g., on my TP600, when my Xircom Ethernet/modem card is inserted and the machine is on AC power. If I do <code>apm —suspend</code> then the kernel apm driver hears about the request first and tells apmd which runs apmd_proxy which runs the scripts in
<code>/etc/apm/event.d</code> which do things like eject the <span class=caps>PCMCIA</span> cards; only then does the apm driver pass the request on to the <span class=caps>BIOS</span>. (I think.) If I do <code>tpctl —suspend</code> on the other hand, the <span class=caps>BIOS</span> hears about the request first and, <em>if the <span class=caps>PCMCIA</span> card is still inserted, it rejects the request with a couple of beeps (high—-low).</em> <code>apm —suspend</code> is therefore to be preferred to <code>tpctl —suspend</code>.</p>Unfortunately, there is no alternative to
<code>tpctl —hibernate</code> : the apm program and the kernel apm driver don't know how to ask for hibernation. Solution: write a little script that does <code>cardctl eject ; tpctl —hib</code>. <code>Fn-F4</code> does the same as <code>tpctl —suspend</code> and <code>Fn-F12</code> does the same as <code>tpctl —hibernate</code>.</blockquote><p>The mention of the <span class=caps>BIOS</span> rejecting the suspend request when a <span class=caps>PCMCIA</span> card is inserted is exactly what I was seeing – I'm using my wireless card right now.</p><p>So after all that, I learned that I should suspend using <code>apm -s</code> and not with the thinkpad buttons if I have a pcmcia card active. With no <span class=caps>PCMCIA</span> card, the suspend request will be handled correctly by <span class=caps>APM</span> and apmd, and everything should be happy.</p><p><strong>References:</strong></p><ol><li><a href=http://www.linux-thinkpad.org/FAQ/cache/32.html>Why doesn't my Thinkpad hibernate? | Linux-ThinkPad <span class=caps>FAQ</span></a></li></ol><p>Various records of Linux Installation attempts:</p><ol><li><a href=http://www.loria.fr/~stuber/t30/debian-ibm-t30-2366-085.html>How to set up an <span class=caps>IBM</span> Thinkpad T30 Debian <span class=caps>GNU</span>/Linux</a></li><li><a href=http://www.open-organizations.org/view/Socialtools/LinuxOnThinkpadT23>Debian <span class=caps>GNU</span>/Linux on an <span class=caps>IBM</span> Thinkpad T23</a></li><li><a href=http://www.geocities.com/dirk_wetter/thinkpad/tp_suse8/index.html#s>Linux on A30p – Sound</a></li><li><a href=http://www.biplane.com.au/~kauer/miscellaneous/ibmt30-notes.html>SuSE Linux 8.0 on <span class=caps>IBM</span> T30 Thinkpad</a></li><li><a href=http://lists.debian.org/debian-devel/2000/debian-devel-200007/msg01108.html>Re: ThinkPad 600, kernel 2.2.17pre6, and hibernation</a></li><li><a href=http://mailman.linux-thinkpad.org/pipermail/linux-thinkpad/2001-March/004174.html lang=ltp><span class=caps>APMD</span> and Standby on the TP-T21</a></li><li><a href=http://article.gmane.org/gmane.linux.gentoo.user/35506 title="was Re: [gentoo-user] Laptop + Gentoo">artsshell permissions</a></li></ol><p>Older Alsa drivers:</p><ol><li><a href=http://www.alex.org.uk/T23/>Installing & Running Linux on an <span class=caps>IBM</span> T23 Laptop</a></li><li><a href=http://static.linuxcare.com/certs/intel8x0.diff>Patch to cards/card-intel8&#215;0.c for suspend/resume</a></li></ol><p>Information for Linux on <span class=caps>IBM</span> Laptops</p><ol><li><a href=http://www9.linuxcare.com/>LinuxCare</a> – <a href=http://www9.linuxcare.com/labs/certs/ibm/thinkpad/t23/><span class=caps>IBM</span> T23 certification</a></li><li><a href=http://www.linux-on-laptops.com/ibm.html>Linux on <span class=caps>IBM</span> Laptops</a></li><li><a href=http://www.linux-thinkpad.org/FAQ/>Linux-ThinkPad <span class=caps>FAQ</span></a></li></ol><p><span class=caps>APM</span> / Other tools</p><ol><li><a href=http://www.worldvisions.ca/~apenwarr/apmd/ title="Version 3.0.2">The Linux <span class=caps>APM</span> Daemon</a></li><li><a href=http://www.miketaylor.org.uk/tech/deb/>deb2targz</a></li></ol><p>Everywhere I looked, things would reference debian's <code>/etc/apm/event.d/alsa</code> script. Thing is, I don't run debian, and I'll be damned if I could find the contents of the script anywhere.</p><p>For future reference, I've attached the source <a href=/files/alsa>here</a>.</p></article><article><h2>It's Alive!! (Gentoo and T23)</h2><p>So a comment on the first of my entries about Gentoo on a T23 reminded me to make an update regarding my now working system...</p><p>I also sorted out my <a href="{{ site.baseurl }}{% link _posts/2003-09-22-gentoo-t23-and-vmware.html %}"><span class=caps>VMW</span>are issues</a>.</p><p><strong>Kernel Configuration</strong></p><p>Here is my <a href=/files/config-2.4.20-gentoo-r7.txt title=config-2.4.20-gentoo-r7>working kernel configuration</a></p><p>Significant points:<ul><li><span class=caps>APM</span> compiled in</li><li><span class=caps>ACPI</span> y, with sub-items as modules</li><li><span class=caps>PCMCIA</span>/Cardbus support compiled in (emerged pcmcia-cs with cardbus disabled)</li><li><span class=caps>IPSEC</span> as a module</li><li>Only the <span class=caps>EEPRO</span> module for <span class=caps>PCI</span> network support</li><li>Wireless <span class=caps>PCI</span> and Wireless <span class=caps>PCMCIA</span> and network <span class=caps>PCMCIA</span> support in modules</li><li>Only Sound support and <span class=caps>OSS</span> sound support, both as modules. Emerged alsa-driver for sound support.</li></ul></p><p><strong><span class=caps>VMW</span>are configuration</strong></p><p>This kind of sorted itself out. I spoke to a co-worker, and he said he hadn't had to do anything funny to get <span class=caps>VMW</span>are to stop complaining. So, I deleted /etc/devfs.d/vmware (a file I'd created to recreate the devfs link for vmmon), I removed vmnet and vmmon from /etc/modules.autoload.d/kernel-2.4 (I'd tried a few variations with the two modules here.. ).</p><p>I'd forgotten tweaking the <span class=caps>VMW</span>are start-up script to load the vmmon and vmnet modules. When I upgraded the <span class=caps>VMW</span>are-workstation ebuild (because of some minor change), etc-update reminded me, and I scrapped those changes to. For some reason, with absolutely no intervention on my part, <span class=caps>VMW</span>are now remains configured on it's own.</p><p>I probably thought it was having trouble because I was recompiling the kernel between reboots, something extremely unusual for me to do, but something that would cause the vmware modules to complain when they were loaded.</p><p><sighs></p><p>Everything is smashing, now!</p></article><article><h2>Gentoo, T23, and VMWare</h2><p><a href=http://lindows.prodigydigital.com/tutorials/vmware.html>Why do I have to run vmware-config.pl every time I reboot my computer?</a></p><p>This was happening to me, and while that's a lindows tutorial, it hit the nail on the head:</p><blockquote><p>Because devfs rebuilds the /dev tree at each reboot, it is likely that your vmnet and vmmon devices will become unavailable. Because those devices are now unavailable, you have to manually run the vmware-config.pl to rebuild them into the existing /dev tree.</p></blockquote><p><strong>[UPDATE: 9/29/2004]</strong> This is total hogwash, see <a href="{{ site.baseurl }}{% link _posts/2003-09-29-its-alive-gentoo-and-t23.html %}">here</a></p><p>So, I added the vmmon lines to devfs.d/vmware, which should start that part ok. The vmnet nodes are a bit more of a puzzle. One place says put a wrapper around init. I am not brave enough for that, and I'd rather work out the right stuff to have the nodes added by devfs when vmnet is referenced - that would make the most sense to me, anyway.</p><p>from devfsd man page:</p><blockquote><p><strong><span class=caps>RESTORE </span>directory</strong> This will restore entries previously saved under directory to devfs. Only symbolic links or entries with the sticky bit set will be restored. This action is taken as the configuration file is read. With appropriate <span class=caps>COPY </span>actions, complete persistence is acheived.</p></blockquote><p>Will have to look more at that tomorrow, I think that's the only way. getting that damn script to run is not something I want to try, but making a directory that has the vmnet entries in it for devfsd to restore makes more sense.</p><p><strong>yawn</strong></p><p>References:</p><ul><li><a href=http://www.atnf.csiro.au/people/rgooch/linux/docs/devfs.html><span class=caps>DEVFS </span>(Device File System) <span class=caps>FAQ</span></a></li><li><a href="http://wiki.sourcemage.org/index.php?page=HOWTO-devfsd+setup"><span class=caps>HOWTO</span>-devfsd</a></li><li><a href=http://www.gentoo.org/doc/en/rc-scripts.xml>Gentoo Linux 1.0 Init System</a></li><li><a href=http://www-106.ibm.com/developerworks/library/l-fs4.html title="Introduction to devfs">Common threads: Advanced filesystem implementor's guide, Part 4</a></li><li><a href=http://www-106.ibm.com/developerworks/library/l-fs5.html title="Setting up devfs">Common threads: Advanced filesystem implementor's guide, Part 5</a></li></ul></article><article><h2>Dammit- Gentoo on T23 continued</h2><p>So everything was working flawlessly, and I had to switch over into Mandrake to get something, and when I rebooted to Gentoo again, chaos reigned.</p><p>Well, not quite chaos, but several modules were refusing to load, with lots of scary messages about IRQ settings and other hogwash.</p><p>Actually, somehow, with building kernel modules for vmware and alsasound, it seems that module loading got completely hosed – it was trying to load e100, for example, which was a directory name.</p><p>So I edited my kernel config and removed dozens of modules for net, and usb and stuff that I didn't want anyway (i.e. ditched uhci.o in favor of usb_uhci.o, ditched the e100.o driver in favor of eepro100.o). Recreating all of the modules MINUS the alsa drivers helped.</p><p>I also installed the pcmcia-cs package with USE=&#8221;nocardbus&#8221; since PCMCIA and CardBus support are in the kernel.</p><p>After verifying that cleaned up the problem, I re-emerged the alsa-driver&#8230;<br>had to rmmod the sound drivers that had loaded themselves (so just soundcore remained), and restarted alsa, and that seemed happy.</p><p>Rebooted, and everythign is kaflooey again. Sheeiit.<br>Dammit, I'm an idjit. I mean really..</p><blockquote><p>rc-update del alsasound<br>rc-update add alsasound <strong>boot</strong></p></blockquote><p>That fixed it, I'd added alsasound as a default starter, which means the modules were being loaded by the autoload process.</p><p>And THEN, it's still borked&#8230;so I removed the extra sound module, i810_sound.o from the /lib/modules&#8230;. /kernel/sound path (where modules are installed, rebooted, and voila! no nastygrams. So, it looks like alsa and the audio drivers were fighting, and bringing a whole bunch o' extra junk into the match.</p><p>YEESH</p><p>References:</p><blockquote><p>gentoo bug <a href="http://bugs.gentoo.org/show_bug.cgi?id=23491">24391</a></p></blockquote></article><article><h2>Gentoo on a T23</h2><p>Audio: <a href=http://www.intel.com/support/graphics/linux/audio.htm>Intel i810</a>,<br>Alsa <a href="http://www.alsa-project.org/alsa-doc/doc-php/template.php3?company=Intel&card=i820&chip=i820&module=intel8x0">snd-intel8&#215;0</a></p><p>Video: <a href=http://www.probo.com/timr/savage40.html>S3 Savage IX</a> , <a href=http://www.dotfiles.com/files/13/311_XF86Config-T23.txt>Sample XF86Config</a></p><p>Just about everything: <span class=caps>IBM</span> 82801CAM <a href=ftp://download.intel.com/design/chipsets/datashts/29071601.pdf>chipsets</a></p><p><strong>Update: Sept 20, 2003</strong></p><p>First weird thing, I&#8217;m dual booting this machine right now, between my previous Mandrake install, and this new-fangled gentoo thing. And the System.Map generated by the gentoo system led to <span class=caps>REALLY</span> odd video behavior when I later went to build either version.. (now that I think about it, that was with the r6 kernel &#8211; should try the new System.map generated by the r7 kernel..) .. I relinked to the System.map used by Mandrake, and everything was happy &#8211; for either kernel.. whatever.</p><p>Found <a href=http://ghost.hn.org/~clesiuk/SonyVaio/#003>this link</a> &#8211; while it&#8217;s for a Sony Vaio, it&#8217;s also for the exact same intel do-everything chip that I&#8217;ve got in my T23. Some of the pieces, notably the <span class=caps>PCMCIA</span> and <span class=caps>APM</span> stuff, doesn&#8217;t apply to the T23.</p><p>Also <a href=http://www.patoche.org/alone/info/t23.html>this link for a T23 and Debian</a> which was the most helpful (<span class=caps>KISS</span> rule does seem to apply in this case).</p><p>**GAH!!!! *** I got network working, and I&#8217;ve no idea how.</p><p>I enabled <span class=caps>PCMCIA</span> and Cardbus support in the kernel, made <span class=caps>APM</span> a module, enabled <span class=caps>ACPI</span>, made sure the EEPRO100 and E100 drivers were built as modules, along with some of the Wireless <span class=caps>PCMCIA</span> drivers (I have an Orinoco Wireless <span class=caps>PCMCIA</span> card).</p><p>Also updated sys-apps/baselayout, and some other things from the CD version, perhaps some of those updates helped&#8230;</p></article><article><h2>Gentoooooooooooooooooooooo</h2><p>Jimminy Christmas!</p><p>Everything was paddling along smoothly until I hit this little hiccup, I've got an ATI RADEON card, which is apparently a whole pile of badness.</p><p>Thank goodness some punks have figured this crap out before me!</p><p>Gentoo Install (the chicken-shit I've never done this before way):</p><ol><li><p>Follow the <a href=http://gentoo.org/doc/en/gentoo-x86-install.xml>docs</a> till you're blue in the face, specifically:</p><ul><li><p>stage 3 install</p></li><li><p>get beginning packages from CD's saves some time</p></li><li><p>in <code>/etc/make.conf</code>, set some USE vars: <code>radeon gnome gtk2 -kde -qt mysql -ldap</code></p></li><li><p>timezone <code>EST5EDT</code></p></li><li><p>use genkernel for compile with caveat – I have a stupid radeon, so run genkernel-config, and turn agpgart on, but DRM off:</p><pre><code>Processor type and features—&gt;
&lt;*&gt; MTRR (Memory Type Range Register) support
Character devices—&gt;
&lt;*&gt; /dev/agpgart (AGP Support)
[*] all chipsets compiled into kernel (just to be safe)
[ ] Direct Rendering Manager (XFree86 DRI support)
</code></pre></li><li><p>continue with above instructions, get xfree-drm</p></li></ul></li><li><p>cancel the middle of an emerge only if you're ready to do some serious patchwork. Basically, don't start unless you're ready to finish.</p></li><li><p>not done yet, I'll let you know</p></li></ol><p>See <a href=http://www.gentoo.org/doc/en/dri-howto.xml>Hardware 3D Acceleration Guide</a>, which seems to be a more official version of
<a href="http://forums.gentoo.org/viewtopic.php?t=46681">Gentoo Forums :: View topic - Direct rendering (DRI) using XFree-DRM HOWTO</a></p></article></div><footer class=page-footer><div id=copyrights>&#169; 2002-2021 Erin Schnabel</div><div><a target=_blank href=https://github.com/ebullient title="ebullient on GitHub"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1664 896q0 251-146.5 451.5T1139 1625q-27 5-39.5-7t-12.5-30v-211q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105T1386 856q0-121-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27T578 459.5 492 446q-44 113-7 204-79 85-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-40 36-49 103-21 10-45 15t-57 5-65.5-21.5T484 1274q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 89t.5 54q0 18-13 30t-40 7q-232-77-378.5-277.5T128 896q0-209 103-385.5T510.5 231 896 128t385.5 103T1561 510.5 1664 896z" fill="#fff"/></svg></a><a target=_blank href=https://twitter.com/ebullientworks title="Follow @ebullientworks"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5T1369.5 1125 1185 1335.5t-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5T285 1033q33 5 61 5 43 0 85-11-112-23-185.5-111.5T172 710v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5T884 653q-8-38-8-74 0-134 94.5-228.5T1199 256q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z" fill="#fff"/></svg></a><a target=_blank href=https://www.linkedin.com/in/erinschnabel/ title="Erin Schnabel on linked.in"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991H147V625h330zm21-306q1 73-50.5 122T312 490h-2q-82 0-132-49t-50-122q0-74 51.5-122.5T314 148t133 48.5T498 319zm1166 729v568h-329v-530q0-105-40.5-164.5T1168 862q-63 0-105.5 34.5T999 982q-11 30-11 81v553H659q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5T1285 602q171 0 275 113.5t104 332.5z" fill="#fff"/></svg></a><a target=_blank href=https://gameontext.org/slackin/ title="ebullient on gameontext.slack.com"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1583 776q62 0 103.5 40.5T1728 918q0 97-93 130l-172 59 56 167q7 21 7 47 0 59-42 102t-101 43q-47 0-85.5-27t-53.5-72l-55-165-310 106 55 164q8 24 8 47 0 59-42 102t-102 43q-47 0-85-27t-53-72l-55-163-153 53q-29 9-50 9-61 0-101.5-40T260 1323q0-47 27.5-85t71.5-53l156-53-105-313-156 54q-26 8-48 8-60 0-101-40.5T64 740q0-47 27.5-85t71.5-53l157-53-53-159q-8-24-8-47 0-60 42-102.5T403 198q47 0 85 27t53 72l54 160 310-105-54-160q-8-24-8-47 0-59 42.5-102T987 0q47 0 85.5 27.5T1126 99l53 161 162-55q21-6 43-6 60 0 102.5 39.5T1529 337q0 45-30 81.5t-74 51.5l-157 54 105 316 164-56q24-8 46-8zm-794 262 310-105-105-315-310 107z" fill="#fff"/></svg></a><a target=_blank href=https://pinboard.in/u:ebullient title=pinboard.in><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 25 25" enable-background="new 0 0 25 25"><polygon fill="#fff" points="13.908,14.85 9.211,19.547 9.961,15.412 3.571,7.706 0,7.894 7.895,0 7.895,3.007 15.412,9.773 20.111,8.647 15.227,13.721 25,24.436"/></svg></a><a target=_blank href=/index.xml title=Subscribe><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M576 1344q0 80-56 136t-136 56-136-56-56-136 56-136 136-56 136 56 56 136zm512 123q2 28-17 48-18 21-47 21H889q-25 0-43-16.5t-20-41.5q-22-229-184.5-391.5T250 902q-25-2-41.5-20T192 839V704q0-29 21-47 17-17 43-17h5q160 13 306 80.5T826 902q114 113 181.5 259t80.5 306zm512 2q2 27-18 47-18 20-46 20h-143q-26 0-44.5-17.5T1329 1476q-12-215-101-408.5t-231.5-336-336-231.5T252 398q-25-1-42.5-19.5T192 335V192q0-28 20-46 18-18 44-18h3q262 13 501.5 120T1186 542q187 186 294 425.5t120 501.5z" fill="#fff"/></svg></a></div></footer><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1146860-5','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>